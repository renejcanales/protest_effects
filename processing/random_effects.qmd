---
title: "Análisis de Resultados: Tesis de Magister"
format:
  html: 
    code-fold: true
    html-math-method: katex
    number-sections: true
    code-link: true
    title-block-banner: true
    theme:
      - pretty.scss
  pdf: 
    geometry: margin=2cm
    template-partials: 
      - title.tex
    keep-tex: true
    include-in-header:
      text: |
        \usepackage[noblocks]{authblk}
        \renewcommand*{\Authsep}{, }
        \renewcommand*{\Authand}{, }
        \renewcommand*{\Authands}{, }
        \renewcommand\Affilfont{\small}
    number-sections: true
editor: source
author:   
  - name: René Canales
    affiliations:
      - ref: 1
      - ref: 2     
affiliations: 
  - id: 1
    name: Instituto de Sociología, Pontificia Universidad Católica de Chile
  - id: 2
    name: Centro de estudios del conflicto y cohesión social (COES)
citeproc: true
abstract: | 
  \newline
  **Keywords**: 
link-citations: true
linestretch: 1.5       
mainfont: Times New Roman
fontsize: 13pt          
colorlinks: true
fig-height: 4
fig-width: 7.5
---

## Librerías y Data

```{r}
#| results: false
#| warning: false
#| message: false

if (!require("pacman")) install.packages("pacman")

pacman::p_load(plm, # Modelos Panel
               dplyr,
               lme4,
               ggplot2,
               sjlabelled,
               interactions, # Gráficos de Interacción
               marginaleffects, # Effectos Marginales
               lmtest, # Test de DIagnósticos
               sandwich, # Errores Robustos
               multcomp, # Contrastes post-hoc
               stargazer, # Tablas
               sjmisc,
               psych, # Descriptivos
               texreg, # Tablas de Regresión
               sjPlot,
               here,
               tidyr,
               naniar,
               dplyr,
               broom,
               broom.mixed)

options(scipen=999)
rm(list = ls())

load(here("input/data/proc/elsoc_long.RData"))
```

# Descriptivos

```{r}
#| warning: false
#| message: false 

# Grupos para hipótesis específica
elsoc_long <- elsoc_long %>%
  mutate(grupo_hipotesis = case_when(
   # Universitarios con alta movilidad
    anos_educ_encuestado >= 16 & movilidad >= 4 ~ 
      "Universitarios alta movilidad",
    
    # Universitarios sin movilidad
    anos_educ_encuestado >= 16 & movilidad <= 1 ~ 
      "Universitarios sin movilidad",
    
    # Técnicos con movilidad
    anos_educ_encuestado >= 13 & anos_educ_encuestado < 16 & movilidad >= 3 ~ 
      "Técnicos alta movilidad",
    
    # Técnicos sin movilidad
    anos_educ_encuestado >= 13 & anos_educ_encuestado < 16 & movilidad <= 1 ~ 
      "Técnicos sin movilidad",
    
    # Media completa (referencia)
    anos_educ_encuestado >= 12 & anos_educ_encuestado < 13 ~ 
      "Media completa",
    
    # Baja educación
    anos_educ_encuestado < 12 ~ 
      "Baja educación",
    
    # Otros (movilidad moderada en ambos niveles)
    TRUE ~ "Otros"
  ))

# Ordenar niveles de forma lógica
elsoc_long$grupo_hipotesis <- factor(
  elsoc_long$grupo_hipotesis,
  levels = c("Baja educación",
            "Media completa",
            "Técnicos sin movilidad",
            "Técnicos alta movilidad",
            "Universitarios sin movilidad",
            "Universitarios alta movilidad",
            "Otros")
)
```


## Descriptor de Variables

```{r}
#| warning: false
#| message: false
#| results: false

describe (elsoc_long[,c("asist_marcha", "protesta_dummy", "anos_educ_encuestado", "anos_educ_padres_max", "movilidad")]) 
```

## Histogramas de Frecuencia

```{r}
#| warning: false
#| message: false

#Distribución de Asistencia a Marhcas

ggplot(elsoc_long, aes(x = asist_marcha)) + 
  geom_histogram(bins = 30, fill = "steelblue", alpha = 0.7) + 
  theme_minimal() + 
  labs(title = "Distribución de Asistencia a Marchas", x = "Protesta", y = "Frecuencia")

ggplot(elsoc_long, aes(x = anos_educ_encuestado)) + 
  geom_histogram(bins = 30, fill = "steelblue", alpha = 0.7) + 
  theme_minimal() + 
  labs(title = "Distribución de Movilidad", x = "Años de Educación", y = "Frecuencia")

ggplot(elsoc_long, aes(x = anos_educ_padres_max)) + 
  geom_histogram(bins = 30, fill = "darkgreen", alpha = 0.7) + 
  theme_minimal() + 
  labs(title = "Distribución de Años de Educación Padres", x = "Años de Educación Padres", y = "Frecuencia")

ggplot(elsoc_long, aes(x = movilidad)) + 
  geom_histogram(bins = 20, fill = "coral", alpha = 0.7) + 
  geom_vline(xintercept = 0, linetype = "dashed", color = "red") + 
  theme_minimal() + 
  labs(title = "Distribución de Movilidad Educacional", x = "Años de Movilidad", y = "Frecuencia")


```

```{r}
#| warning: false
#| message: false

# Tablas de Frecuencias: Educación Encuestado

table(elsoc_long$educ_encuestado)
prop.table(table(elsoc_long$educ_encuestado)) * 100

table(elsoc_long$movilidad_cat)
prop.table(table(elsoc_long$movilidad_cat)) * 100

# Tablas de Frecuencias: Movilidad Categóricas

table(elsoc_long$movilidad_cat)
prop.table(table(elsoc_long$movilidad_cat)) * 100

# Tablas de Frecuencias: Grupo Hipótesis
table(elsoc_long$grupo_hipotesis)
prop.table(table(elsoc_long$grupo_hipotesis)) * 100

```

