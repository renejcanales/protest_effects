---
title: "Modelos Exploratorios: Tesis de Magister"
format:
  html: 
    code-fold: true
    html-math-method: katex
    number-sections: true
    code-link: true
    title-block-banner: true
    theme:
      - pretty.scss
  pdf: 
    geometry: margin=2cm
    template-partials: 
      - title.tex
    keep-tex: true
    include-in-header:
      text: |
        \usepackage[noblocks]{authblk}
        \renewcommand*{\Authsep}{, }
        \renewcommand*{\Authand}{, }
        \renewcommand*{\Authands}{, }
        \renewcommand\Affilfont{\small}
    number-sections: true
editor: source
author:   
  - name: René Canales
    affiliations:
      - ref: 1
      - ref: 2     
affiliations: 
  - id: 1
    name: Instituto de Sociología, Pontificia Universidad Católica de Chile
  - id: 2
    name: Centro de estudios del conflicto y cohesión social (COES)
citeproc: true
abstract: | 
  \newline
  **Keywords**: 
link-citations: true
linestretch: 1.5       
mainfont: Times New Roman
fontlinewidth: 13pt          
colorlinks: true
fig-height: 4
fig-width: 7.5
---

```{r}
#| results: false
#| warning: false
#| message: false
#| echo: false

if (!require("pacman")) install.packages("pacman")

pacman::p_load(tidyverse,
               sjlabelled, 
               sjmisc, 
               sjPlot,
               gt,
               xfun,
               lme4,
               glmmTMB,
               sjstats,
               here,
               tidyr,
               naniar,
               dplyr,
               broom,
               broom.mixed,
               texreg,
               kableExtra,
               emmeans,
               ggeffects,
               performance)

options(scipen=999)
rm(list = ls())
```


```{r}
#| warning: false
#| message: false
#| echo: false


load(here("input/data/proc/elsoc_final_2.RData"))
```


# Modelos Exploratorios

```{r}
#| warning: false
#| message: false
#| echo: false
#| results: false


# Paso 1: Convertir a factor no ordenado
elsoc_final_2 <- elsoc_final_2 %>%
  mutate(
    educ_cat_unordered = factor(educ_cat_factor, ordered = FALSE),
    movilidad_cat_unordered = factor(movilidad_cat_factor, ordered = FALSE)
  )

```

La educación se convierte en factor ordenado dada la naturaleza jerárquica de la educación. Pues, la educación tiene una secuencia lógica donde cada nivel representa un mayor grado de formación académica. Es decir, constituye una variable ordinal donde el orden importa: Media < Técnica < Universitaria.

Lo anterior permite modelar efectos no lineales. Al ser factor ordenado, se puede capturar el gradiente educativo donde cada nivel superior tiene mayor efecto, se puede detectar patrones no monotónicos y realizar contrastes específicos entre niveles adyacentes.

## Educación y Curva Temporal de Participación

Esta sección examina en qué medida el nivel educativo se relaciona con la **curva temporal** de participación en protestas. A diferencia de los modelos anteriores que tratan el tiempo como variable de control, estos modelos tipo "growth curve" analizan cómo las trayectorias de participación política varían según nivel educativo.

### Preparación de datos: Educación en t1

Para estos modelos, utilizamos el nivel educativo máximo alcanzado medido en la primera ola de cada individuo, asegurando que la educación sea un predictor baseline que no varía con el tiempo.

```{r}
#| warning: false
#| message: false
#| echo: false

# Crear educación baseline (primera medición por individuo)
elsoc_final_2 <- elsoc_final_2 %>%
  group_by(idencuesta) %>%
  arrange(idencuesta, ola) %>%
  mutate(
    # Educación continua en t1
    educ_years_t1 = first(na.omit(educ_years)),
    
    # Educación categórica en t1
    educ_cat_t1 = first(na.omit(as.character(educ_cat_factor)))
  ) %>%
  ungroup() %>%
  mutate(
    # Convertir a factor con mismos niveles
    educ_cat_t1 = factor(educ_cat_t1, 
                         levels = levels(educ_cat_factor))
  )

# Verificar
elsoc_final_2 %>%
  select(idencuesta, ola, educ_years, educ_years_t1, educ_cat_factor, educ_cat_t1) %>%
  head(20) %>%
  kable() %>%
  kable_styling()
```

La tabla muestra que `educ_years_t1` y `educ_cat_t1` capturan el nivel educativo de cada individuo en su primera medición, manteniéndose constante a través de las olas. Esto permite interpretar los modelos como efectos de la educación **baseline** sobre las trayectorias temporales de participación.

### Modelo M1: Nulo (solo efectos aleatorios)

```{r}
#| warning: false
#| message: false
#| echo: false

# M1: Modelo nulo (sin predictores)
m1_growth_null <- glmmTMB(
  protesta_dummy ~ 1 + (1 | idencuesta),
  data = elsoc_final_2,
  family = binomial(link = "logit")
)

screenreg(m1_growth_null, 
          custom.model.names = "M1: Nulo")

# ICC
performance::icc(m1_growth_null)
```

El modelo nulo establece la línea base, mostrando que aproximadamente la mitad de la varianza en participación en protestas se debe a diferencias entre individuos. Este ICC sustancial justifica el uso de modelos multinivel para capturar heterogeneidad individual en las trayectorias de participación.

### Modelo M2: Intercepto + Tiempo

```{r}
#| warning: false
#| message: false
#| echo: false

# M2: Agregar tiempo como factor
m2_growth_time <- glmmTMB(
  protesta_dummy ~ factor(year) + (1 | idencuesta),
  data = elsoc_final_2,
  family = binomial(link = "logit")
)

screenreg(list(m1_growth_null, m2_growth_time),
          custom.model.names = c("M1: Nulo", "M2: + Tiempo"))

# Test LRT
anova(m1_growth_null, m2_growth_time)
```

El Modelo M2 incorpora el tiempo como predictor categórico (año), revelando variación temporal significativa en participación en protestas. El año 2019 (estallido social) muestra el mayor efecto positivo, mientras que otros años presentan efectos negativos respecto al año base 2016. La mejora en el ajuste (LRT p < 0.001) confirma que existe variación temporal significativa que debe ser modelada.

### Modelo M3a: Intercepto + Tiempo + Educación (lineal continua)

```{r}
#| warning: false
#| message: false
#| echo: false

# M3a: Agregar educación CONTINUA (años) medida en t1
m3a_growth_educ_linear <- glmmTMB(
  protesta_dummy ~ factor(year) + educ_years_t1 + 
    (1 | idencuesta),
  data = elsoc_final_2,
  family = binomial(link = "logit")
)

screenreg(list(m2_growth_time, m3a_growth_educ_linear),
          custom.model.names = c("M2: + Tiempo", "M3a: + Educación (lineal)"))

# Test LRT
anova(m2_growth_time, m3a_growth_educ_linear)

```

El Modelo M3a incorpora la educación como predictor **lineal y continuo** (años de escolaridad medidos en t1), asumiendo que cada año adicional de educación tiene un efecto constante sobre la probabilidad de protestar. El coeficiente de educación (`educ_years_t1`) indica si existe un gradiente educativo monotónico en la participación política. La mejora significativa en el ajuste (LRT p < 0.001) confirma que la educación baseline predice las trayectorias de participación a lo largo del tiempo.

**Nota metodológica**: Este modelo asume linealidad en el efecto educativo, lo cual será contrastado con el modelo M3b que utiliza educación categórica para capturar posibles efectos no lineales.

### Modelo M3b: Intercepto + Educación categórica (sin tiempo)

```{r}
#| warning: false
#| message: false
#| echo: false

# M3b: Solo educación CATEGÓRICA (sin tiempo)
m3b_growth_educ_cat <- glmmTMB(
  protesta_dummy ~ educ_cat_t1 + 
    (1 | idencuesta),
  data = elsoc_final_2,
  family = binomial(link = "logit")
)

screenreg(list(m1_growth_null, m3b_growth_educ_cat),
          custom.model.names = c("M1: Nulo", "M3b: + Educación (categórica)"))

# Comparar con M3a (lineal)
screenreg(list(m3a_growth_educ_linear, m3b_growth_educ_cat),
          custom.model.names = c("M3a: Educ lineal", "M3b: Educ categórica"))

# M3c: Educación categórica + tiempo (sin interacción)
m3c_growth_educ_cat <- glmmTMB(
  protesta_dummy ~ educ_cat_t1 + factor(year) +  # Agregar tiempo
    (1 | idencuesta),
  data = elsoc_final_2,
  family = binomial(link = "logit")
)

screenreg(list(m3b_growth_educ_cat, m3c_growth_educ_cat),
          custom.model.names = c("M3b: + Educación (Categórica)", "M3a: + Educación (Categórica) + Tiempo"))
```

El Modelo M3b utiliza educación **categórica** medida en t1, permitiendo capturar efectos no lineales donde diferentes niveles educativos tienen impactos diferenciados sobre la participación en protestas. 

**Comparación M3b (sin tiempo) vs M3a (con tiempo)**: Los resultados revelan hallazgos importantes:

1. **Efecto educativo se intensifica al controlar por tiempo**: Todos los coeficientes educativos aumentan aproximadamente 10-11% cuando se incluye `factor(year)`, indicando que la variación temporal estaba suprimiendo parte del efecto educativo "puro". Por ejemplo, universitaria completa pasa de β = 2.19 (sin tiempo) a β = 2.44 (con tiempo).

2. **Curva temporal pronunciada**: El año 2019 (estallido social) muestra un efecto positivo masivo (β = 0.82, p < 0.001), mientras que 2023 presenta el mayor efecto negativo (β = -1.15, p < 0.001), confirmando variación temporal dramática.

3. **Mejora sustancial en ajuste**: El modelo con tiempo reduce el AIC en 617 puntos (11,834 → 11,217), confirmando que el tiempo es un predictor crucial.

4. **Efectos aditivos (paralelos)**: Este modelo asume que los efectos temporales son constantes across grupos educativos. Es decir, todos los niveles educativos experimentan el mismo aumento en 2019 y la misma caída en 2023, manteniendo diferencias basales entre grupos. Esta asunción de paralelismo será evaluada en el Modelo M4 mediante interacciones tiempo × educación.

### Modelo M4: Intercepto + Tiempo × Educación (interacción)

```{r}
#| warning: false
#| message: false
#| echo: false

# M4: Interacción tiempo × educación categórica
# Separar niveles altos: técnico y universitario

# Crear variable educativa simplificada (3 categorías)
elsoc_final_2 <- elsoc_final_2 %>%
  mutate(
    educ_3cat_t1 = case_when(
      educ_cat_t1 %in% c("Media incompleta o menos") ~ "Media o menos",
      educ_cat_t1 %in% c("Técnica superior incompleta", 
                         "Técnica superior completa") ~ "Técnica superior",
      educ_cat_t1 %in% c("Universitaria incompleta", 
                         "Universitaria completa", 
                         "Postgrado") ~ "Universitaria o más",
      TRUE ~ NA_character_
    ),
    educ_3cat_t1 = factor(educ_3cat_t1, 
                          levels = c("Media o menos", 
                                    "Técnica superior", 
                                    "Universitaria o más"))
  )

# M3d: Educación 3 categorías + tiempo (SIN interacción) - para comparar con M4
m3d_growth_educ3_aditivo <- glmmTMB(
  protesta_dummy ~ factor(year) + educ_3cat_t1 + 
    (1 | idencuesta),
  data = elsoc_final_2,
  family = binomial(link = "logit")
)

# M4: Interacción tiempo × educación (3 categorías)
m4_growth_interaction <- glmmTMB(
  protesta_dummy ~ factor(year) * educ_3cat_t1 + 
    (1 | idencuesta),
  data = elsoc_final_2,
  family = binomial(link = "logit")
)

screenreg(list(m3d_growth_educ3_aditivo, m4_growth_interaction),
          custom.model.names = c("M3d: Educ3cat + Tiempo (aditivo)", 
                                "M4: Tiempo × Educación"))
```

El Modelo M4 representa la especificación más compleja, incorporando una **interacción entre tiempo y educación** que permite examinar si las trayectorias temporales de participación difieren según nivel educativo. La variable educativa se colapsó en 3 categorías para facilitar interpretación y evitar problemas de estimación con interacciones múltiples.

**Hallazgos clave:**

1. **Interacciones limitadas**: De las 10 interacciones posibles, solo 2 son estadísticamente significativas, ambas en el período post-estallido:
   - 2022 × Universitaria: β = -0.60* (universitarios caen 60% más que media/técnicos)
   - 2023 × Universitaria: β = -0.63* (universitarios caen 70% más que media/técnicos)

2. **Curvas paralelas en el estallido social (2019)**: La interacción 2019 × Universitaria NO es significativa (β = -0.15, p > 0.05), indicando que **todos los grupos educativos respondieron similarmente** al estallido social. El aumento masivo de participación en 2019 fue transversal, independiente del nivel educativo.

3. **Divergencia post-crisis**: Los universitarios experimentan una **caída más pronunciada** en 2022-2023, sugiriendo un retorno diferencial al baseline post-movilización masiva. Esto podría reflejar desilusión más acentuada en grupos educados o agotamiento diferencial tras el ciclo de protesta.

4. **Efectos principales robustos**: La educación universitaria mantiene un efecto positivo fuerte (β = 1.39, p < 0.001), y el efecto temporal de 2019 permanece masivo (β = 1.01, p < 0.001).

**Interpretación sustantiva**: La interacción tiempo × educación responde a la pregunta: **¿Los efectos del tiempo (cambios en participación a través de las olas) varían según el nivel educativo de baseline?** La respuesta es **mayormente NO**, con la excepción de una mayor caída de universitarios en 2022-2023. Esto indica que la educación predice principalmente el **nivel** de participación (más educación = más protesta), pero no modera fuertemente la **respuesta a eventos políticos** como el estallido social. Las trayectorias son predominantemente **paralelas** (efectos aditivos), con divergencia selectiva en el período de normalización post-crisis.

```{r}
#| warning: false
#| message: false
#| echo: false

# Comparación de todos los modelos growth curve
screenreg(list(m1_growth_null, 
               m2_growth_time, 
               m3a_growth_educ_linear,
               m3b_growth_educ_cat,
               m3d_growth_educ3_aditivo,
               m4_growth_interaction),
          custom.model.names = c("M1: Nulo", 
                                "M2: Tiempo", 
                                "M3a: Educ (lineal)",
                                "M3b: Educ (cat)",
                                "M3d: Educ3 + Tiempo",
                                "M4: Tiempo × Educ"))

# Test LRT: ¿La interacción mejora el modelo?
# IMPORTANTE: Comparar M3d vs M4 (misma variable educativa, mismo N)
lrt_growth <- anova(m3d_growth_educ3_aditivo, m4_growth_interaction)
print(lrt_growth)

# Interpretación basada en p-value:
# Si p < 0.05 → La interacción es significativa → Las curvas NO son paralelas
# Si p > 0.05 → La interacción NO mejora → Las curvas SON paralelas (modelo aditivo preferido)
```

La tabla comparativa muestra la evolución del ajuste del modelo a medida que se agregan predictores. El test de razón de verosimilitud (LRT) evalúa formalmente si la interacción tiempo × educación mejora significativamente el ajuste respecto al modelo aditivo.

**Evaluación del LRT (M3d vs M4)**: El test de razón de verosimilitud compara el modelo aditivo M3d (educación 3 categorías + tiempo, sin interacción) con el modelo M4 (interacción completa). Los resultados revelan hallazgos importantes:

**Resultado del LRT**: χ² = 14.877 (df = 5), **p = 0.011** (significativo)

**Conclusión estadística**: La interacción tiempo × educación **SÍ mejora significativamente el modelo** (p < 0.05), indicando que las trayectorias temporales **NO son completamente paralelas** entre grupos educativos. Aunque solo 2 de 10 interacciones individuales fueron significativas (2022 × Universitaria, 2023 × Universitaria), el test conjunto confirma que estas interacciones aportan valor predictivo sustancial. La mejora en AIC (ΔAIC = -4.9) y el BIC comparable respaldan esta conclusión.

**Interpretación sustantiva (interacción selectiva)**: El patrón de interacción es **parcial y temporalmente específico**, no generalizado:

1. **Período pre-estallido (2017-2018)**: Curvas paralelas (NO interacción significativa)
   - Las diferencias educativas baseline se mantienen constantes
   
2. **Estallido social (2019)**: Curvas paralelas (β = -0.15, p > 0.05)
   - **Hallazgo crítico**: Todos los grupos educativos respondieron similarmente al estallido
   - La movilización masiva fue transversal, independiente del nivel educativo
   
3. **Post-estallido (2022-2023)**: **Curvas divergentes** (interacciones significativas)
   - Universitarios experimentan caída **más pronunciada** (-60% en 2022, -70% en 2023)
   - Retorno diferencial al baseline: grupos más educados "se retiran" más rápidamente
   - Posibles explicaciones: desilusión política más acentuada, agotamiento diferencial, o satisfacción diferencial con resultados del ciclo de protesta

**Implicación teórica central**: La educación predice principalmente el **NIVEL** de participación (efecto principal robusto: β = 1.39, p < 0.001), pero también modera **selectivamente** la **normalización post-crisis**. El hallazgo de que el estallido social de 2019 movilizó transversalmente (sin interacción) desafía teorías de movilización diferencial, mientras que la divergencia post-2019 sugiere que los grupos educativos difieren en sus patrones de **desmovilización** más que en su **respuesta inicial** a eventos políticos críticos.

**Decisión de modelo óptimo**: El LRT significativo (p = 0.011) justifica la adopción del **Modelo M4 (interacción)** como especificación final, a pesar de su mayor complejidad. Esto permite capturar la dinámica temporal diferenciada en el período post-estallido, que es teóricamente relevante para comprender los procesos de normalización política tras ciclos de protesta masiva.

### Visualización de trayectorias por nivel educativo

```{r}
#| warning: false
#| message: false
#| echo: false
#| fig-height: 6
#| fig-width: 8
#| label: fig-growth-trajectories
#| fig-cap: "Probabilidades predichas de participación en protestas según año y nivel educativo (baseline)"

library(ggeffects)

# Predicciones del modelo M4
pred_growth <- ggpredict(m4_growth_interaction, 
                         terms = c("year", "educ_3cat_t1"))

# Gráfico
plot(pred_growth) +
  labs(
    title = "Trayectorias de participación en protestas según educación baseline",
    subtitle = "Modelo M4: Interacción tiempo × educación",
    x = "Año",
    y = "Probabilidad predicha de protestar",
    color = "Educación (t1)"
  ) +
  theme_minimal(base_size = 12) +
  theme(legend.position = "bottom")
```

**Interpretación del gráfico**: El gráfico revela el patrón de **interacción selectiva** que el LRT confirmó estadísticamente (χ² = 14.88, p = 0.011). Las tres trayectorias muestran:

**Fase 1 (2016-2018): Niveles basales diferenciados, curvas paralelas**
- Universitarios: ~28% probabilidad (nivel más alto)
- Técnica superior: ~6-8% 
- Media o menos: ~9%
- Las diferencias educativas son estables (no hay interacción)

**Fase 2 (2019): Estallido social - Movilización transversal**
- **TODOS los grupos aumentan proporcionalmente** (curvas paralelas ascendentes)
- Universitarios: saltan de ~17% a ~49% (+32 pp)
- Técnica superior: saltan de ~5% a ~22% (+17 pp)
- **Hallazgo crítico**: La distancia relativa entre grupos se mantiene = NO hay moderación educativa en la respuesta al estallido social

**Fase 3 (2022-2023): Post-estallido - Desmovilización diferencial**
- **Aquí emerge la INTERACCIÓN significativa** (curvas divergentes)
- Universitarios: caen mucho más rápido (de ~49% en 2019 a ~14% en 2022, ~8% en 2023)
- Técnica superior: caen menos intensamente (de ~22% a ~6% en 2022-2023)
- Media o menos: descenso moderado (~4% en 2023)
- **Las curvas DIVERGEN**: universitarios se desmovilizaron más intensamente que otros grupos

**Implicaciones teóricas**: El gráfico es evidencia visual de que la educación **NO modera la movilización** ante crisis políticas (2019: respuesta transversal), pero **SÍ modera la desmovilización** post-crisis (2022-2023: universitarios abandonan protesta más rápidamente). Este patrón sugiere posibles mecanismos como desilusión diferencial (mayores expectativas del proceso constituyente frustradas), agotamiento por mayor involucramiento inicial, o retorno a estrategias convencionales tras el fracaso del canal institucional (rechazo constitucional).

### Interpretación y conclusiones preliminares

```{r}
#| warning: false
#| message: false
#| echo: false

# Tabla resumen de criterios de ajuste - GRUPO 1 (muestra completa)
tabla_grupo1 <- tibble(
  Modelo = c("M1: Nulo", "M2: Tiempo", "M3a: Educ (lineal)", "M3b: Educ (categórica)"),
  AIC = c(AIC(m1_growth_null), AIC(m2_growth_time), 
          AIC(m3a_growth_educ_linear), AIC(m3b_growth_educ_cat)),
  BIC = c(BIC(m1_growth_null), BIC(m2_growth_time), 
          BIC(m3a_growth_educ_linear), BIC(m3b_growth_educ_cat)),
  `Log-Lik` = c(logLik(m1_growth_null)[1], logLik(m2_growth_time)[1],
                logLik(m3a_growth_educ_linear)[1], logLik(m3b_growth_educ_cat)[1]),
  N = c(nobs(m1_growth_null), nobs(m2_growth_time),
        nobs(m3a_growth_educ_linear), nobs(m3b_growth_educ_cat))
) %>%
  mutate(
    `ΔAIC vs anterior` = AIC - lag(AIC),
    `ΔBIC vs anterior` = BIC - lag(BIC)
  ) %>%
  gt() %>%
  tab_header(
    title = "Comparación de modelos: Grupo 1 (N = 16,244)",
    subtitle = "Modelos con educación continua y categórica 5 niveles"
  ) %>%
  fmt_number(
    columns = c(AIC, BIC, `Log-Lik`, `ΔAIC vs anterior`, `ΔBIC vs anterior`),
    decimals = 1
  ) %>%
  fmt_number(
    columns = N,
    decimals = 0,
    use_seps = TRUE
  ) %>%
  tab_footnote(
    footnote = "Valores negativos en Δ indican mejora en ajuste"
  ) %>%
  cols_align(
    align = "left",
    columns = Modelo
  )

tabla_grupo1

# Tabla resumen de criterios de ajuste - GRUPO 2 (educación 3 categorías)
tabla_grupo2 <- tibble(
  Modelo = c("M3d: Educ3 + Tiempo", "M4: Tiempo × Educ3"),
  AIC = c(AIC(m3d_growth_educ3_aditivo), AIC(m4_growth_interaction)),
  BIC = c(BIC(m3d_growth_educ3_aditivo), BIC(m4_growth_interaction)),
  `Log-Lik` = c(logLik(m3d_growth_educ3_aditivo)[1], logLik(m4_growth_interaction)[1]),
  N = c(nobs(m3d_growth_educ3_aditivo), nobs(m4_growth_interaction)),
  k = c(attr(logLik(m3d_growth_educ3_aditivo), "df"),
        attr(logLik(m4_growth_interaction), "df"))
) %>%
  mutate(
    `ΔAIC` = AIC - lag(AIC),
    `ΔBIC` = BIC - lag(BIC)
  ) %>%
  gt() %>%
  tab_header(
    title = "Comparación de modelos: Grupo 2 (N = 7,434)",
    subtitle = "Modelos con educación 3 categorías (Media/Técnica/Universitaria)"
  ) %>%
  fmt_number(
    columns = c(AIC, BIC, `Log-Lik`, `ΔAIC`, `ΔBIC`),
    decimals = 1
  ) %>%
  fmt_number(
    columns = c(N, k),
    decimals = 0,
    use_seps = TRUE
  ) %>%
  tab_footnote(
    footnote = "Valores negativos en Δ indican mejora. k = número de parámetros"
  ) %>%
  cols_align(
    align = "left",
    columns = Modelo
  )

tabla_grupo2
```

### Síntesis general de hallazgos

**¿Qué nos dicen estas comparaciones de modelos en general?**

**1. Progresión del ajuste (Tabla 1, N = 16,244)**

- **M1 → M2 (ΔAIC = -609)**: La inclusión del tiempo mejora **dramáticamente** el ajuste. Esto confirma que la participación en protestas NO es estable: existe variación sustancial a través de los años, especialmente por el estallido social de 2019. Este modelo establece que el **tiempo importa**.

- **M2 → M3a (ΔAIC = -559)**: Agregar educación continua produce otra mejora muy grande. Esto indica que la educación baseline es un predictor **fundamental** de las trayectorias de protesta, independiente del tiempo. El modelo ahora captura dos fuentes de variación: temporal (cuándo) y educativa (quién).

- **M3a vs M3b**: La especificación categórica (5 niveles) tiene peor ajuste que la continua, sugiriendo que la relación educación-protesta es mayormente **lineal** (más educación = más protesta), no escalonada con umbrales abruptos.

**2. La cuestión de la interacción (Tabla 2, N = 7,434)**

- **M3d vs M4 (ΔAIC = -4.9, LRT p = 0.011)**: Aunque la mejora en AIC es **pequeña** (solo -4.9 puntos), el test LRT confirma que es **estadísticamente significativa**. Esto revela un patrón crucial: la educación NO solo eleva el nivel de protesta (efecto aditivo), sino que también **modera** cómo las personas responden al tiempo.

- **Paradoja aparente**: El BIC de M4 es PEOR (+29.7) que M3d. ¿Por qué? Porque BIC penaliza más fuertemente la complejidad del modelo (5 parámetros adicionales). Esto indica que:
  * Según **parsimonia estricta** (BIC): preferir M3d
  * Según **significancia estadística y teoría** (LRT + AIC): preferir M4
  * **Decisión óptima**: Adoptar M4 porque captura un fenómeno teóricamente relevante (desmovilización diferencial post-estallido) que M3d no puede detectar.

**3. Heterogeneidad de muestra: ¿Por qué N = 7,434 en Grupo 2?**

La reducción de N = 16,244 a N = 7,434 (pérdida de 54% de observaciones) se debe a la creación de `educ_3cat_t1` que excluye casos con educación faltante en t1 o que no tienen las categorías específicas. Esto es **metodológicamente correcto** porque:

- Los modelos M3d/M4 requieren educación medida al baseline (t1) para modelar trayectorias
- La categorización en 3 niveles (Media/Técnica/Universitaria) es necesaria para detectar efectos diferenciales entre estos grupos específicos
- Aunque la muestra es menor, es suficiente (N > 7,000) para análisis multinivel robustos

**4. El veredicto sustantivo: ¿Qué aprendimos?**

Estas comparaciones revelan **tres hallazgos centrales**:

a) **La educación es el predictor más fuerte de protesta** (ΔAIC = -559 en M3a): Mucho más importante que cualquier otro factor individual. Cada año adicional de educación aumenta sustancialmente la probabilidad de protestar.

b) **El tiempo es altamente variable pero no lineal** (M2): La participación no aumenta o disminuye gradualmente; experimenta un pico enorme en 2019 (estallido) y un colapso posterior (2023). Esto refleja la naturaleza **episódica** de la protesta masiva en Chile.

c) **La educación modera selectivamente las trayectorias temporales** (M4, LRT p = 0.011): No todos los grupos educativos responden igual al tiempo. Específicamente:
   - Durante crisis (2019): respuesta transversal (todos suben)
   - Post-crisis (2022-2023): desmovilización diferencial (universitarios bajan más)

**5. Implicación metodológica clave**

La separación en dos tablas no es solo cosmética: refleja una decisión analítica fundamental. **No podemos comparar directamente** M3a (educación continua, N = 16,244) con M4 (educación 3 categorías, N = 7,434) porque:
- Diferentes variables (años vs categorías)
- Diferentes muestras (completa vs restringida)
- Diferentes objetivos (linealidad vs heterogeneidad de efectos)

Por eso el análisis correcto es: usar Tabla 1 para establecer que educación importa (M3a), luego usar Tabla 2 para examinar si su efecto varía por nivel educativo específico (M4). Ambas preguntas son complementarias, no competitivas.

**Conclusiones clave**:

1. **Variación temporal significativa**: El Modelo M2 confirma que existe variación sustancial en participación en protestas a través del tiempo, con 2019 como año pico (β = +0.82) y 2023 como mínimo (β = -1.15).

2. **Efecto educativo robusto e intensificado**: La educación baseline predice significativamente la participación política. Crucialmente, el efecto educativo se **intensifica** (~10%) cuando se controla por tiempo, sugiriendo que la variación temporal suprimía parte del efecto educativo. Esto indica que las diferencias educativas son reales y no artefactos de variación temporal.

3. **Linealidad vs no-linealidad**: La comparación de AIC entre M3a (educación lineal + tiempo) y M3b (educación categórica) sugiere que ambas especificaciones capturan adecuadamente la relación, con ventaja para modelos que incluyen control temporal.

4. **Interacción tiempo × educación SIGNIFICATIVA (hallazgo central)**: El test LRT confirma que la interacción mejora significativamente el modelo (χ² = 14.88, p = 0.011), rechazando la hipótesis de curvas paralelas. Sin embargo, el patrón es de **interacción selectiva**:
   - **2019 (estallido social)**: Todos los grupos subieron igual (curvas paralelas)
   - **2022-2023 (post-estallido)**: Universitarios cayeron **más** que otros grupos (curvas divergentes)
   
5. **Implicación teórica central REVISADA**: La educación opera en dos dimensiones temporales diferenciadas:
   
   a) **Respuesta a crisis (2019)**: La educación NO modera la respuesta a eventos políticos críticos. El estallido social movilizó transversalmente a todos los grupos educativos sin diferencias significativas. Esto desafía teorías de movilización diferencial y sugiere que eventos de magnitud suficiente generan efectos de "techo" que anulan ventajas educativas.
   
   b) **Normalización post-crisis (2022-2023)**: La educación SÍ modera el retorno al baseline. Universitarios se desmovilizaron más rápidamente (-60% adicional en 2022, -70% en 2023), sugiriendo desilusión política diferencial, agotamiento más pronunciado, o satisfacción/insatisfacción diferencial con los resultados del ciclo de protesta.
   
   c) **Nivel baseline**: La educación predice fuertemente el nivel de participación en condiciones normales (β = 1.39, p < 0.001).

6. **Decisión de modelo óptimo**: El test LRT justifica la adopción del **Modelo M4 (interacción)** como especificación final (p = 0.011, ΔAIC = -4.9). Aunque la interacción es selectiva (solo significativa en 2 de 10 términos), captura dinámicas temporales diferenciadas teóricamente relevantes para comprender procesos de movilización y desmovilización política tras ciclos de protesta masiva.

7. **Contribución empírica**: Este análisis revela que la relación educación-protesta es **temporalmente contingente**: la educación predice quién protesta "normalmente", pero no quién responde más intensamente a crisis políticas, aunque sí predice quién se desmoviliza más rápidamente tras dichas crisis. Esta triple distinción (nivel/respuesta/desmovilización) refina teorías sobre el rol de la educación en la participación política contestataria.


# Modelos Descriptivos para Protesta

**Diferencia con modelos growth curve**: Mientras que los modelos anteriores (M1-M4) examinaban cómo las **trayectorias temporales** de participación varían según educación baseline, esta sección estima modelos donde el tiempo es tratado como **variable de control** (efectos fijos por año) y la educación como predictor transversal. El objetivo es evaluar hipótesis específicas sobre (H1) la no linealidad del efecto educativo y (H2) la interacción entre educación alcanzada y movilidad social, controlando por variación temporal pero sin modelar interacciones tiempo × educación.

**Justificación de estructura multinivel**: Como se estableció en los modelos growth curve, el ICC = 0.475 indica que aproximadamente la mitad de la varianza en participación se debe a diferencias estables entre individuos. Todos los modelos en esta sección son regresiones logísticas multinivel con efectos aleatorios por individuo, ajustando por la correlación intra-individual inherente a diseños de panel longitudinal.

## Modelos para H1 (No linealidad)

**Especificación de educación**: Se utiliza `educ_cat_unordered` (factor NO ordenado) en lugar de `educ_cat_factor` (ordenado) porque H1 predice patrones **no monotónicos específicos** (ej: universitaria incompleta > completa) que los contrastes polinómicos (.L, .Q, .C) no pueden capturar adecuadamente. Esta especificación permite comparaciones directas entre cada nivel educativo y la categoría de referencia (Media completa).

### Progresión de modelos

```{r}
#| warning: false
#| message: false
#| echo: false

# Modelo 1: Solo educación (sin controles)
mod1_educ_simple <- glmmTMB(
  protesta_dummy ~ educ_cat_unordered + 
    (1 | idencuesta),
  data = elsoc_final_2,
  family = binomial(link = "logit"))

# Modelo 2: Educación + demográficos
mod2_educ_demo <- glmmTMB(
  protesta_dummy ~ educ_cat_unordered + 
    edad + mujer +
    (1 | idencuesta),
  data = elsoc_final_2,
  family = binomial(link = "logit"))

# Modelo 3: + variables actitudinales y temporales
mod3_h1_tmb <- glmmTMB(
  protesta_dummy ~ educ_cat_unordered + 
    edad + mujer +
    ideologia_std + interes_politica +
    factor(year) +
    (1 | idencuesta),
  data = elsoc_final_2,
  family = binomial(link = "logit"))

# Modelo 4 Full: + confianza y eficacia política
mod3_h1_full <- glmmTMB(
  protesta_dummy ~ educ_cat_unordered + 
    edad + mujer +
    ideologia_std + interes_politica +
    conf_instituciones + eficacia_politica +
    factor(year) +
    (1 | idencuesta),
  data = elsoc_final_2,
  family = binomial(link = "logit"))

# Tabla comparativa
screenreg(list(mod1_educ_simple, mod2_educ_demo, mod3_h1_tmb, mod3_h1_full),
          custom.model.names = c("M1: Educación", "M2: + Demográficos", 
                                 "M3: + Actitudinales/Tiempo", "M4 Full"))
```

**Hallazgos clave de la progresión**:

**M1 (educación sola)**: Patrón mayormente ascendente con educación:
- Técnica incompleta: β = 0.96*** vs Técnica completa: β = 1.11*** (completa > incompleta)
- Universitaria incompleta: β = 2.13*** vs Universitaria completa: β = 2.19*** (completa > incompleta) 
- **Contrario a H1**: Completar educación aumenta (no disminuye) participación en protestas

**M2 (+ demográficos)**: Coeficientes educativos se atenúan ~50% al controlar edad (-0.05***) y género (-0.21**), pero patrón ascendente persiste.

**M3 (+ actitud/tiempo)**: Ideología (-0.21***) e interés político (0.53***) son predictores muy fuertes. 2019 único año positivo (0.69***). Patrón educativo se mantiene robusto.

**M4 Full**: Confianza institucional no significativa (-0.07, p > 0.05), eficacia política tampoco (0.05, p > 0.05). Coeficientes educativos estables. **Patrón definitivo**:
- Técnica incompleta: 0.44* < Técnica completa: 0.73***
- Universitaria incompleta: 1.03*** < Universitaria completa: 1.23***
- **Conclusión**: Completar educación aumenta participación, rechazando H1.

### Tabla comparativa de ajuste

```{r}
#| warning: false
#| message: false
#| echo: false

# Tabla de comparación H1
library(gt)
tibble(
  Modelo = c("M1: Educación", "M2: + Demográficos", "M3: + Actitud/Tiempo", "M4 Full"),
  AIC = c(AIC(mod1_educ_simple), AIC(mod2_educ_demo), AIC(mod3_h1_tmb), AIC(mod3_h1_full)),
  BIC = c(BIC(mod1_educ_simple), BIC(mod2_educ_demo), BIC(mod3_h1_tmb), BIC(mod3_h1_full)),
  `Log-Lik` = c(logLik(mod1_educ_simple)[1], logLik(mod2_educ_demo)[1],
                logLik(mod3_h1_tmb)[1], logLik(mod3_h1_full)[1]),
  N = c(nobs(mod1_educ_simple), nobs(mod2_educ_demo), 
        nobs(mod3_h1_tmb), nobs(mod3_h1_full))
) %>%
  mutate(
    `ΔAIC` = AIC - lag(AIC)
  ) %>%
  gt() %>%
  tab_header(
    title = "Comparación de modelos H1: No linealidad educativa"
  ) %>%
  fmt_number(
    columns = c(AIC, BIC, `Log-Lik`, `ΔAIC`),
    decimals = 1
  ) %>%
  fmt_number(
    columns = N,
    decimals = 0,
    use_seps = TRUE
  ) %>%
  tab_footnote(
    footnote = "ΔAIC negativo indica mejora en ajuste"
  )
```

**Interpretación**: La mejora más dramática ocurre en M3, confirmando que variables actitudinales y controles temporales son cruciales. M4 Full aporta mejora marginal, indicando rendimientos decrecientes.

**Nota sobre contrastes polinómicos**: Si hubieras usado `educ_cat_factor` (ordenado), verías coeficientes `.L` (lineal), `.Q` (cuadrático), `.C` (cúbico) que asumen tendencias **suaves y monotónicas**. Esto es **inapropiado para H1** que predice irregularidades específicas (incompleta > completa). Por eso usamos factor **no-ordenado** que permite comparaciones directas entre cada nivel.

### Test formal de no-linealidad

```{r}
#| warning: false
#| message: false
#| echo: false

# Modelo con educación CONTINUA (años) para comparar con categórica
mod_educ_continua <- glmmTMB(
  protesta_dummy ~ educ_years + 
    edad + mujer +
    ideologia_std + interes_politica +
    conf_instituciones + eficacia_politica +
    factor(year) +
    (1 | idencuesta),
  data = elsoc_final_2,
  family = binomial(link = "logit"))

# Comparación lado a lado
screenreg(list(mod_educ_continua, mod3_h1_full),
          custom.model.names = c("Educación Continua (lineal)", "Educación Categórica"))

# Test LRT
anova(mod_educ_continua, mod3_h1_full)
```

**Resultado del test de linealidad**: El LRT compara educación continua (asume linealidad) vs categórica (captura no-linealidad). Si p < 0.05, rechazamos linealidad y adoptamos modelo categórico. La comparación de AIC/BIC también favorecerá el modelo categórico si la no-linealidad es sustantiva.

**Decisión**: Adoptar **modelo categórico (M4 Full)** como especificación final para H1, capturando patrón complejo donde universitaria incompleta > completa y postgrado máximo efecto.

### Visualización de efectos educativos

```{r}
#| warning: false
#| message: false
#| echo: false
#| fig-height: 6
#| fig-width: 8
#| label: fig-h1-educ-effects
#| fig-cap: "Probabilidades predichas de participación en protestas según nivel educativo"

library(ggeffects)

# Predicciones marginales del modelo M4 Full
pred_h1 <- ggpredict(mod3_h1_full, terms = "educ_cat_unordered")

# Gráfico
plot(pred_h1) +
  labs(
    title = "Efecto no lineal de la educación sobre participación en protestas",
    subtitle = "Modelo M4 Full con controles completos",
    x = "Nivel Educativo",
    y = "Probabilidad predicha de protestar"
  ) +
  theme_minimal(base_size = 11) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

**Interpretación del gráfico**: El gráfico muestra un patrón **mayormente ascendente y monotónico**:
1. Media incompleta o menos = baseline (~7%)
2. Técnica incompleta (~10%) < Técnica completa (~13%)
3. Universitaria incompleta (~18%) < Universitaria completa (~21%)

**Este patrón CONTRADICE H1**: La hipótesis predecía que incompleta > completa debido a frustración y conciencia crítica sin cooptación. Los datos muestran lo contrario: **completar educación aumenta (no disminuye) participación**.

**Implicación**: La relación educación-protesta es mayormente **lineal y ascendente**, no el patrón no-lineal invertido que H1 predijo. Aunque hay pequeñas irregularidades, la tendencia dominante es "más educación = más protesta", consistent con teorías de recursos cívicos, no con teorías de frustración relativa.

### Rechazo de H1 y mecanismos alternativos

**¿Por qué H1 falló?**

**H1 predecía**: Incompleta > Completa porque:
1. Frustración de expectativas truncadas
2. Socialización crítica sin cooptación institucional
3. Mayor juventud/activismo

**Los datos muestran**: Completa > Incompleta porque:

1. **Recursos cívicos dominan**: Completar educación proporciona más habilidades, conocimiento, y confianza para participar políticamente
2. **Capital social acumulativo**: Redes profesionales/académicas más densas facilitan reclutamiento y movilización
3. **Efecto credencial**: Título completo confiere legitimidad y voz en espacios políticos
4. **Persistencia vs deserción**: Quienes completan pueden tener rasgos de personalidad (persistencia, agencia) que también predicen activismo

**Implicación teórica**: El efecto educativo en protesta opera **principalmente** a través de **recursos cívicos** (mecanismo capacitante), no a través de **frustración relativa** (mecanismo motivacional). La educación no radicaliza por frustración, sino que **empodera** para participar efectivamente.

**Decisión**: **RECHAZAR H1**. La relación educación-protesta es **mayormente lineal y ascendente**, no el patrón no-lineal invertido (incompleta > completa) que la hipótesis predecía. Aunque hay pequeñas desviaciones de linealidad perfecta, estas no constituyen el patrón específico propuesto por H1.

### Tests específicos para H1 (eliminados por problemas técnicos)

## Modelos para H2 (Movilidad Educacional)

**Hipótesis H2**: El efecto de la educación sobre la participación en protestas varía según la trayectoria de movilidad social experimentada. Específicamente, se espera que personas con movilidad educacional ascendente (superan el nivel educativo de sus padres) muestren patrones diferentes de participación política que aquellas con movilidad descendente o estabilidad intergeneracional.

**Especificación de variables**: Tanto educación como movilidad se modelan como **factores NO ordenados** para:
1. Mantener consistencia con el análisis de H1 (educación no ordenada)
2. Permitir detectar efectos específicos de cada tipo de movilidad sin asumir relaciones monotónicas
3. Facilitar interpretación directa de coeficientes (vs contrastes polinómicos)
4. Capturar posibles patrones no lineales en ambas dimensiones

**Estrategia analítica**: Probar tres modelos anidados que permiten evaluar si la movilidad educacional opera:
1. **Modelo 4 (Solo movilidad)**: Efecto independiente de trayectorias de movilidad, sin controlar por nivel educativo alcanzado
2. **Modelo 5 (Aditivo)**: Efectos separados de educación alcanzada y movilidad social, asumiendo independencia
3. **Modelo 6 (Interacción)**: Efectos condicionales donde la movilidad modera el impacto de la educación

**Implicación de muestra reducida**: Los modelos H2 utilizan N = 12,018 (vs 15,203 en H1) debido a la exclusión de casos sin información completa de educación parental, necesaria para construir la variable de movilidad intergeneracional.

### Progresión de modelos

```{r}
#| warning: false
#| message: false
#| echo: false

library(glmmTMB)

# Modelo 4: Solo movilidad (sin educación alcanzada)
mod4_movilidad <- glmmTMB(
  protesta_dummy ~ movilidad_cat_unordered + 
    edad + mujer +
    ideologia_std + interes_politica +
    factor(year) +
    (1 | idencuesta),
  data = elsoc_final_2 %>% filter(!is.na(movilidad_cat)),
  family = binomial(link = "logit"))

# Modelo 5: Educación + Movilidad (aditivo)
mod5_aditivo <- glmmTMB(
  protesta_dummy ~ educ_cat_unordered + movilidad_cat_unordered + 
    edad + mujer +
    ideologia_std + interes_politica +
    factor(year) +
    (1 | idencuesta),
  data = elsoc_final_2 %>% filter(!is.na(movilidad_cat)),
  family = binomial(link = "logit"))

# Modelo 6: Interacción Educación × Movilidad
mod6_h2_interaccion <- glmmTMB(
  protesta_dummy ~ educ_cat_unordered * movilidad_cat_unordered + 
    edad + mujer +
    ideologia_std + interes_politica +
    factor(year) +
    (1 | idencuesta),
  data = elsoc_final_2 %>% filter(!is.na(movilidad_cat)),
  family = binomial(link = "logit"))

# Tabla comparativa
screenreg(list(mod4_movilidad, mod5_aditivo, mod6_h2_interaccion),
          custom.model.names = c("M4: Solo Movilidad", "M5: Aditivo (Educ + Movilidad)", "M6: Interacción"))
```

**Hallazgos clave de la progresión**:

#### **Modelo 4 (Solo Movilidad)**: 

La movilidad educacional por sí sola muestra efectos diferenciados según el tipo de trayectoria:
- Cada categoría de movilidad se compara con la categoría de referencia
- Permite ver efectos específicos de movilidad descendente, estabilidad, y diferentes niveles de ascenso
- Sin controlar por destino educativo, los efectos pueden estar confundidos

**Interpretación**: Las trayectorias de ascenso o descenso educacional intergeneracional, sin considerar el nivel educativo de destino, pueden mostrar diferencias. Sin embargo, para entender el efecto **puro** de la movilidad, necesitamos controlar por el nivel alcanzado (M5).

**Variables de control robustas**:
- Edad: -0.05*** (mayores protestan menos)
- Mujer: -0.26** (brecha de género)
- Ideología: -0.21*** (derecha reduce protesta)
- Interés político: 0.51*** (predictor más fuerte)
- Año 2019: único período positivo (estallido social)

#### **Modelo 5 (Aditivo)**: 

Al **controlar simultáneamente** por educación alcanzada y movilidad, podemos ver los efectos independientes de cada variable:

**Efectos educativos** (robustos, similares a M3 Full):
- Cada nivel educativo se compara con la categoría de referencia
- Patrón ascendente: mayor educación = mayor participación
- Efectos específicos para técnica superior, universitaria, postgrado

**Efectos de movilidad** (independientes del nivel educativo):
- Cada tipo de movilidad muestra su efecto propio
- Comparación con categoría de referencia (típicamente estabilidad intergeneracional)
- Permite ver si movilidad ascendente/descendente tiene efectos diferenciados

**Interpretación clave**: Si encontramos efectos significativos de movilidad en este modelo, significa que **la trayectoria importa** independientemente del destino. Entre personas con el mismo nivel educativo final, las trayectorias de movilidad pueden generar diferencias en participación política.

#### **Modelo 6 (Interacción)**:

El modelo de interacción evalúa si el efecto de cada nivel educativo **varía según** el tipo de movilidad social:

**Estructura del modelo**:
- Efectos principales de educación (cada nivel vs referencia)
- Efectos principales de movilidad (cada tipo vs referencia)  
- Términos de interacción (educación × movilidad para cada combinación)

**Evaluación de H2**:
- Si las interacciones son significativas → El efecto de educación depende de la movilidad
- Si las interacciones NO son significativas → Educación y movilidad operan independientemente

**Resultado esperado**: Dado el gran número de parámetros estimados (cada nivel de educación × cada tipo de movilidad), el modelo puede presentar problemas de sobreajuste si los datos no tienen suficiente variación.

**Conclusión preliminar**: El modelo de interacción está sobreajustado y no mejora la capacidad predictiva.

### Tabla comparativa de ajuste

```{r}
#| warning: false
#| message: false
#| echo: false

library(gt)

# Tabla de comparación H2
tibble(
  Modelo = c("M4: Solo Movilidad", "M5: Aditivo (Educ + Movilidad)", "M6: Interacción"),
  AIC = c(AIC(mod4_movilidad), AIC(mod5_aditivo), AIC(mod6_h2_interaccion)),
  BIC = c(BIC(mod4_movilidad), BIC(mod5_aditivo), BIC(mod6_h2_interaccion)),
  `Log-Lik` = c(logLik(mod4_movilidad)[1], logLik(mod5_aditivo)[1], 
                logLik(mod6_h2_interaccion)[1]),
  N = c(nobs(mod4_movilidad), nobs(mod5_aditivo), nobs(mod6_h2_interaccion)),
  k = c(
    attr(logLik(mod4_movilidad), "df"),
    attr(logLik(mod5_aditivo), "df"),
    attr(logLik(mod6_h2_interaccion), "df")
  )
) %>%
  mutate(
    `ΔAIC` = AIC - lag(AIC),
    `ΔBIC` = BIC - lag(BIC)
  ) %>%
  gt() %>%
  tab_header(
    title = "Comparación de modelos H2: Movilidad educacional",
    subtitle = "¿El efecto de la educación varía según movilidad social?"
  ) %>%
  fmt_number(
    columns = c(AIC, BIC, `Log-Lik`, `ΔAIC`, `ΔBIC`),
    decimals = 1
  ) %>%
  fmt_number(
    columns = c(N, k),
    decimals = 0,
    use_seps = TRUE
  ) %>%
  tab_footnote(
    footnote = "ΔAIC/ΔBIC negativos indican mejora. k = número de parámetros estimados"
  ) %>%
  cols_align(
    align = "center",
    columns = everything()
  )
```

**Interpretación de criterios de ajuste**:

1. **M4 → M5 (ΔAIC = -110, ΔBIC = -65)**:
   - Mejora dramática al agregar educación alcanzada
   - Confirma que educación es predictor crucial
   - La movilidad se vuelve significativa solo al controlar por destino educativo
   
2. **M5 → M6 (ΔAIC = +14, ΔBIC = +133)**:
   - El AIC empeora ligeramente (+14 puntos)
   - El BIC penaliza fuertemente la complejidad (+133 puntos)
   - Agregar 16 términos de interacción NO justifica la complejidad
   
3. **Conclusión**: El **Modelo 5 Aditivo** es la especificación óptima según parsimonia y ajuste.

3. **Conclusión**: El **Modelo 5 Aditivo** es la especificación óptima según parsimonia y ajuste.

### Test formal de interacción (Likelihood Ratio Test)

```{r}
#| warning: false
#| message: false
#| echo: false

# Likelihood Ratio Test: ¿La interacción mejora el modelo?
lrt_h2 <- anova(mod5_aditivo, mod6_h2_interaccion)
print(lrt_h2)
```

**Resultado del LRT**:
- χ² = [valor del test]
- p = [p-value]

**Interpretación según resultado**:

- **p > 0.05**: Las interacciones NO son significativas → H2 rechazada → Educación y movilidad operan independientemente

**Nota metodológica**: Con factores NO ordenados, estamos evaluando si hay interacciones **específicas** entre niveles particulares de educación y tipos específicos de movilidad (ej: universitaria completa × movilidad ascendente alta). Esto es más flexible que contrastes polinómicos, pero requiere más parámetros.

### Visualización del modelo óptimo (M5 Aditivo)

```{r}
#| warning: false
#| message: false
#| echo: false
#| fig-height: 7
#| fig-width: 10
#| label: fig-h2-aditivo-efectos
#| fig-cap: "Efectos independientes de educación y movilidad social sobre participación en protestas"

library(ggeffects)
library(patchwork)

# Panel A: Efecto de educación (controlando movilidad)
pred_educ <- ggpredict(mod5_aditivo, terms = "educ_cat_unordered")

plot_educ <- plot(pred_educ) +
  labs(
    title = "A) Efecto de Educación Alcanzada",
    subtitle = "Controlando por movilidad social",
    x = "Nivel Educativo",
    y = "Probabilidad predicha de protestar"
  ) +
  theme_minimal(base_size = 11) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# Panel B: Efecto de movilidad (controlando educación)
pred_movilidad <- ggpredict(mod5_aditivo, terms = "movilidad_cat_unordered")

plot_movilidad <- plot(pred_movilidad) +
  labs(
    title = "B) Efecto de Movilidad Social",
    subtitle = "Controlando por nivel educativo alcanzado",
    x = "Tipo de Movilidad Educacional",
    y = "Probabilidad predicha de protestar"
  ) +
  theme_minimal(base_size = 11) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# Combinar gráficos
plot_educ + plot_movilidad +
  plot_annotation(
    title = "Efectos Aditivos (Independientes): Educación y Movilidad",
    subtitle = "Modelo M5 - Especificación Final para H2",
    caption = "Fuente: Elaboración propia con ELSOC 2016-2023"
  )
```

**Interpretación de los gráficos**:

**Panel A (Educación alcanzada)**:
- Patrón ascendente claro y robusto
- Media incompleta o menos: ~8% de probabilidad
- Postgrado: ~18-20% de probabilidad
- **Efecto principal más fuerte**: La educación es el predictor dominante
- Intervalos de confianza estrechos → estimaciones precisas

**Panel B (Movilidad social)**:
- Patrón **descendente** con movilidad ascendente
- Movilidad descendente: ~14-15% de probabilidad
- Estabilidad: ~12-13%
- Movilidad ascendente baja: ~11-12%
- Movilidad ascendente alta: ~10-11%
- **Efecto integrativo**: Ascender socialmente reduce protesta

**Comparación de magnitudes**:
- Efecto educación: ~12 puntos porcentuales (de 8% a 20%)
- Efecto movilidad: ~4-5 puntos porcentuales (de 15% a 10%)
- **Educación domina**, pero movilidad aporta información adicional

**Visualización de la NO-interacción** (evidencia contra H2):

```{r}
#| warning: false
#| message: false
#| echo: false
#| fig-height: 6
#| fig-width: 10
#| label: fig-h2-no-interaccion
#| fig-cap: "Curvas paralelas confirman ausencia de interacción entre educación y movilidad"

# Predicciones cruzadas desde modelo aditivo
pred_cruzado <- ggpredict(mod5_aditivo, 
                          terms = c("educ_cat_unordered", "movilidad_cat_unordered"))

# Gráfico
ggplot(pred_cruzado, 
       aes(x = x, y = predicted, color = group, group = group)) +
  geom_point(size = 2.5, position = position_dodge(width = 0.3)) +
  geom_line(position = position_dodge(width = 0.3), linewidth = 0.8) +
  geom_errorbar(aes(ymin = conf.low, ymax = conf.high),
                width = 0.2, position = position_dodge(width = 0.3),
                alpha = 0.6) +
  scale_y_continuous(limits = c(0, 0.35), 
                     labels = scales::percent_format(accuracy = 1)) +
  scale_color_viridis_d(option = "plasma", begin = 0.2, end = 0.8) +
  labs(
    title = "Educación y Movilidad: Efectos Aditivos (Curvas Paralelas)",
    subtitle = "Modelo M5 Aditivo - Las líneas paralelas confirman ausencia de interacción",
    x = "Nivel Educativo Alcanzado",
    y = "Probabilidad Predicha de Protestar",
    color = "Movilidad\nEducacional",
    caption = "Fuente: ELSOC 2016-2023. Las curvas paralelas indican que el efecto de educación\nes constante independientemente de la trayectoria de movilidad social."
  ) +
  theme_minimal(base_size = 12) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "right",
    plot.caption = element_text(hjust = 0, size = 9, color = "gray40")
  )
```

**Interpretación del gráfico de curvas paralelas**:

1. **Paralelismo visual confirmado**:
   - Las cuatro líneas (tipos de movilidad) mantienen pendientes similares
   - NO hay cruces ni divergencias sistemáticas
   - Patrón consistente con modelo aditivo (efectos independientes)

2. **Efecto constante de educación**:
   - Cada línea sube de manera similar a través del gradiente educativo
   - El "beneficio" de más educación es el mismo para todos los tipos de movilidad
   - NO hay evidencia de que movilidad ascendente/descendente amplifique o atenúe el efecto educativo

3. **Separación vertical constante**:
   - Las líneas mantienen distancias similares entre sí
   - Movilidad descendente (arriba) vs ascendente alta (abajo) = diferencia constante
   - Esto es exactamente lo que predice un modelo aditivo

4. **Contraste con H2**:
   - Si H2 fuera correcta, veríamos líneas **convergentes** o **divergentes**
   - Por ejemplo: movilidad ascendente × universitaria debería mostrar efecto diferente
   - Los datos NO apoyan este patrón condicional

**Conclusión visual**: El gráfico proporciona evidencia visual clara de que educación y movilidad operan **independientemente**, validando la decisión de adoptar el modelo aditivo y rechazar H2.

### Síntesis de hallazgos H2

**Pregunta central**: ¿El efecto de la educación sobre la participación en protestas varía según la trayectoria de movilidad social?

**Respuesta empírica**: **NO**. La educación y la movilidad social operan como **predictores independientes** de la participación política contestataria.

#### **Evidencia convergente para rechazar H2**:

1. **Test estadístico formal**:
   - LRT: χ² = 17.32, p = 0.365 (NO significativo)
   - Solo 1 de 16 interacciones individuales es significativa
   - Mejora en ajuste no justifica complejidad (ΔAIC = +14, ΔBIC = +133)

2. **Evidencia visual**:
   - Curvas paralelas en gráfico de efectos cruzados
   - NO hay convergencia ni divergencia sistemática
   - Separación vertical constante entre tipos de movilidad

3. **Problemas de estimación**:
   - Colinealidad perfecta en 2 términos de interacción
   - Pérdida generalizada de significancia en modelo de interacción
   - Señales de sobreajuste estadístico

#### **Hallazgos sustantivos del modelo óptimo (M5 Aditivo)**:

**1. Efecto de educación alcanzada** (robusto y dominante):
- Media incompleta: -0.61*** (baseline bajo)
- Técnica superior: 0.32* - 0.41*
- Universitaria: 0.61*** - 0.63***
- Postgrado: 0.99*** (máximo efecto)
- **Rango total**: ~12 puntos porcentuales (8% a 20%)

**2. Efecto de movilidad social** (independiente y lineal):
- Término lineal: **-0.26*** (p < 0.05)**
- Movilidad ascendente **reduce** participación
- Efecto constante across niveles educativos
- **Rango total**: ~4-5 puntos porcentuales

**3. Magnitud relativa**:
- **Educación**: Predictor principal (efecto 3x más fuerte)
- **Movilidad**: Efecto secundario pero significativo
- Ambos aportan información complementaria (ΔAIC = -110)

#### **Implicaciones teóricas**:

**Teorías NO confirmadas (requieren interacción)**:
- ❌ **Frustración relativa**: Movilidad ascendente + educación alta NO genera radicalización diferencial
- ❌ **Expectativas frustradas**: Universitarios con movilidad descendente NO protestan más
- ❌ **Efectos condicionales**: La movilidad NO amplifica ni atenúa el efecto educativo

**Teorías CONFIRMADAS (efectos aditivos)**:
- ✅ **Recursos cívicos** (educación): Más educación = más habilidades, redes, conocimiento para participar
- ✅ **Integración social** (movilidad): Ascenso social = mayor identificación con el sistema
- ✅ **Mecanismos separados**: Educación capacita, movilidad integra (pathways causales distintos)

#### **Contribución empírica**:

Este análisis demuestra que:

1. **Dónde llegas importa más que de dónde vienes**: El nivel educativo alcanzado predice fuertemente la participación, independientemente del origen familiar.

2. **Movilidad social tiene efecto propio**: El ascenso intergeneracional reduce protesta, pero este efecto es **uniforme** across niveles educativos, no condicional.

3. **Distinción analítica necesaria**: Educación y movilidad deben modelarse separadamente para capturar sus efectos específicos, evitando confundir destino con trayectoria.

4. **Implicación metodológica**: Modelos que asumen interacciones automáticas entre estatus alcanzado y movilidad pueden sobreajustar y producir resultados espurios. El modelo aditivo es más parsimonioso y robusto.

**Decisión final**: Adoptar **Modelo 5 Aditivo** como especificación final para análisis de movilidad social. **Rechazar formalmente H2**.

## Análisis de Mediación

### Modelo con mediaciones

```{r}
#| warning: false
#| message: false
#| echo: false

# Modelo 7: Agregar variables mediadoras
mod7_mediacion <- glmmTMB(
  protesta_dummy ~ educ_cat_unordered * movilidad_cat_unordered + 
    # Mediadores
    justicia_distributiva + meritocracia + 
    clase_subjetiva + satis_ingreso_std +
    # Controles
    edad + mujer +
    ideologia_std + interes_politica +
    factor(year) +
    (1 | idencuesta),
  data = elsoc_final_2 %>% filter(!is.na(movilidad_cat)),
  family = binomial(link = "logit"))


screenreg(mod7_mediacion)
```

El Modelo 7 de Mediación incorpora variables actitudinales (justicia distributiva, meritocracia, clase subjetiva y satisfacción con ingresos) para evaluar si los efectos de educación y movilidad operan a través de estos mecanismos específicos. Los resultados revelan cambios sustanciales en los coeficientes educativos al incluir estos mediadores potenciales: varios niveles educativos pierden significancia estadística, incluyendo educación media incompleta (-0.42, no significativa), técnica superior incompleta (0.35, no significativa), universitaria completa (0.37, no significativa) y postgrado (1.12, no significativa), mientras que solo técnica superior completa (0.58, p < 0.05) y universitaria incompleta (1.11, p < 0.001) mantienen efectos significativos. Esta reducción generalizada en la significancia y magnitud de los coeficientes educativos sugiere que una porción considerable del efecto educativo sobre la participación en protestas opera indirectamente a través de actitudes hacia la justicia social, estratificación y posición de clase.

Las variables mediadoras muestran efectos en direcciones teóricamente esperadas: mayor percepción de justicia distributiva reduce la participación en protestas (-0.14, p < 0.05), así como mayor identificación con clases sociales superiores (-0.15, p < 0.05), mientras que meritocracia y satisfacción con ingresos no alcanzan significancia estadística. La reducción dramática en el tamaño muestral (de 12,018 a 3,723 observaciones) refleja la disponibilidad limitada de variables actitudinales en el panel ELSOC, lo que limita la generalización de estos hallazgos. No obstante, los resultados proporcionan evidencia preliminar de mediación parcial: los efectos educativos se atenúan al controlar por actitudes, sugiriendo que la educación influye en la protesta tanto directamente (a través de recursos cívicos y habilidades) como indirectamente (moldeando percepciones sobre justicia social y posición de clase). La persistencia de algunos efectos educativos significativos indica mediación parcial rather than completa, consistent con teorías multidimensionales que enfatizan múltiples pathways causales entre educación y participación política contestataria.

### Comparar efecto total vs directo

```{r}
#| warning: false
#| message: false
#| echo: false


library(broom.mixed)
library(dplyr)

# 1. Extraer efectos de movilidad
coefs_mod6 <- tidy(mod6_h2_interaccion, effects = "fixed") %>%
  filter(grepl("movilidad_cat_unordered", term)) %>%
  select(term, estimate_total = estimate, se_total = std.error, p_total = p.value)

coefs_mod7 <- tidy(mod7_mediacion, effects = "fixed") %>%
  filter(grepl("movilidad_cat_unordered", term)) %>%
  select(term, estimate_directo = estimate, se_directo = std.error, p_directo = p.value)

# 2. Comparar efectos
comparacion_movilidad <- coefs_mod6 %>%
  inner_join(coefs_mod7, by = "term") %>%
  mutate(
    efecto_indirecto = estimate_total - estimate_directo,
    cambio_pct = ((estimate_directo - estimate_total) / abs(estimate_total)) * 100,
    reduccion = abs(estimate_directo) < abs(estimate_total)
  )

print(comparacion_movilidad)

# 3. También para educación (efectos principales)
coefs_educ_mod6 <- tidy(mod6_h2_interaccion, effects = "fixed") %>%
  filter(grepl("^educ_cat_unordered[^:]", term)) %>%  # Sin interacciones
  select(term, estimate_total = estimate, se_total = std.error, p_total = p.value)

coefs_educ_mod7 <- tidy(mod7_mediacion, effects = "fixed") %>%
  filter(grepl("^educ_cat_unordered[^:]", term)) %>%
  select(term, estimate_directo = estimate, se_directo = std.error, p_directo = p.value)

comparacion_educacion <- coefs_educ_mod6 %>%
  inner_join(coefs_educ_mod7, by = "term") %>%
  mutate(
    efecto_indirecto = estimate_total - estimate_directo,
    prop_mediada = (efecto_indirecto / estimate_total) * 100,
    reduccion = abs(estimate_directo) < abs(estimate_total)
  )

print(comparacion_educacion)
```

El análisis de mediación para los efectos de movilidad social permite examinar si las variables actitudinales (justicia distributiva, meritocracia, clase subjetiva, satisfacción con ingresos) explican parte de la relación entre movilidad y protesta. Con factores no ordenados, comparamos los coeficientes de cada tipo específico de movilidad (descendente, estabilidad, ascendente baja, ascendente alta) entre el modelo total (M6) y el modelo con mediadores (M7). Los cambios en los coeficientes indican qué proporción del efecto de cada tipo de movilidad opera a través de actitudes versus mecanismos directos.

Los términos de interacción muestran patrones más diversos en cuanto a mediación: algunas interacciones se reducen en magnitud (como universitaria incompleta × movilidad lineal: de -0.404 a 0.037), mientras que otras se intensifican (como media incompleta × movilidad lineal: de 0.202 a 0.429), y otras cambian de dirección completamente (como técnica superior incompleta × movilidad lineal: de -0.118 a 0.364). Sin embargo, es crucial notar que estos cambios ocurren en un contexto donde las interacciones no eran estadísticamente significativas en el modelo original, y la reducción dramática del tamaño muestral (de 12,018 a 3,723) limita la confiabilidad de estas comparaciones. El análisis sugiere que las variables actitudinales (justicia distributiva, clase subjetiva) median algunos aspectos de cómo la movilidad social afecta la participación política, pero la evidencia es fragmentaria y debe interpretarse con cautela dado el rechazo previo de la hipótesis de interacción y las limitaciones muestrales del modelo de mediación.

Para los efectos educativos principales, el análisis de mediación revela evidencia robusta de mediación parcial a través de variables actitudinales, con patrones diferenciados según el nivel educativo. Los resultados muestran que la educación media incompleta o menos experimenta una reducción moderada en su efecto negativo (de -0.637 a -0.419, representando 34% de mediación), mientras que los niveles de educación superior muestran patrones más complejos. La educación técnica superior completa muestra una intensificación paradójica (de 0.271 a 0.578), lo que sugiere supresión estadística donde las variables actitudinales revelan efectos educativos previamente ocultos. Los niveles de educación universitaria presentan los patrones de mediación más claros: universitaria incompleta se intensifica considerablemente (de 0.553 a 1.11, indicando 101% de "mediación negativa"), mientras que universitaria completa cambia sustancialmente (de 0.135 a 0.370), y postgrado también se intensifica (de 0.509 a 1.12).

Los patrones observados sugieren que las variables actitudinales no solo median los efectos educativos sino que también actúan como supresores estadísticos, revelando efectos educativos "puros" una vez controladas las actitudes hacia la justicia social y la estratificación. Esto es particularmente evidente en educación universitaria incompleta, donde el control por variables actitudinales revela un efecto más fuerte, sugiriendo que este grupo tiene actitudes que normalmente reducirían la participación política pero que, una vez controladas, emerge su verdadero potencial contestatario. El patrón general indica que la educación opera a través de múltiples pathways: directamente (a través de recursos cívicos y habilidades) e indirectamente (moldeando actitudes hacia el sistema social), con algunos niveles educativos mostrando efectos suprimidos por sus orientaciones actitudinales características. Estos hallazgos son consistentes con teorías multidimensionales de la participación política que enfatizan tanto recursos como motivaciones actitudinales como mediadores de los efectos educativos.

```{r}
#| warning: false
#| message: false
#| echo: false

library(ggplot2)
library(tidyr)

# Gráfico para educación
comparacion_educacion %>%
  mutate(term = gsub("educ_cat_unordered", "", term)) %>%
  pivot_longer(
    cols = c(estimate_total, estimate_directo),
    names_to = "modelo",
    values_to = "estimate"
  ) %>%
  mutate(
    modelo = ifelse(modelo == "estimate_total", 
                    "Efecto Total\n(sin mediadores)", 
                    "Efecto Directo\n(con mediadores)")
  ) %>%
  ggplot(aes(x = term, y = estimate, fill = modelo)) +
  geom_col(position = position_dodge(width = 0.8), width = 0.7) +
  coord_flip() +
  labs(
    title = "Análisis de Mediación: Efectos de Educación sobre Protesta",
    subtitle = "La reducción indica mediación por variables actitudinales",
    x = "Nivel Educativo",
    y = "Coeficiente (log-odds)",
    fill = "Tipo de Efecto"
  ) +
  theme_minimal() +
  theme(legend.position = "bottom")

# Resumen de proporción mediada
comparacion_educacion %>%
  mutate(term = gsub("educ_cat_unordered", "", term)) %>%
  ggplot(aes(x = reorder(term, prop_mediada), y = prop_mediada)) +
  geom_col(fill = "steelblue") +
  geom_hline(yintercept = 0, linetype = "dashed") +
  coord_flip() +
  labs(
    title = "Proporción del Efecto Educativo Mediada",
    subtitle = "% del efecto que opera a través de actitudes (justicia, meritocracia, clase, etc.)",
    x = "Nivel Educativo",
    y = "% del Efecto Mediado"
  ) +
  theme_minimal()
```

Los gráficos del análisis de mediación proporcionan evidencia visual clara de cómo las variables actitudinales median los efectos educativos sobre la participación en protestas, revelando patrones complejos de mediación parcial y supresión estadística. El primer gráfico, compara los efectos totales (verde) versus los efectos directos (rojo) para cada nivel educativo y sus interacciones con movilidad, mostrando que la inclusión de variables mediadoras (justicia distributiva, meritocracia, clase subjetiva, satisfacción con ingresos) altera sustancialmente las magnitudes de los coeficientes. Los efectos principales de educación muestran patrones mixtos: algunos se reducen (indicando mediación tradicional), otros se intensifican (sugiriendo supresión estadística), y varios cambian de dirección completamente. Particularmente notable es que los niveles de educación universitaria (incompleta y completa) así como postgrado muestran intensificación de sus efectos al controlar por actitudes, sugiriendo que estos grupos tienen orientaciones actitudinales que normalmente reducirían su participación política, pero una vez controladas, emerge su verdadero potencial contestatario.

El segundo gráfico, cuantifica el porcentaje del efecto educativo que opera a través de las variables actitudinales, revelando una variabilidad extrema en los patrones de mediación. El gráfico muestra que algunos efectos experimentan mediación sustancial (barras largas hacia la derecha), otros muestran "mediación negativa" o supresión (barras hacia la izquierda), y muchos presentan valores cercanos a cero. Los resultados más llamativos incluyen efectos que superan el 100% de mediación (valores > 500%), lo que indica supresión estadística donde las variables actitudinales revelan efectos educativos previamente ocultos. Este patrón es consistente con teorías multidimensionales que sugieren que la educación opera tanto directamente (a través de recursos cívicos) como indirectamente (moldeando actitudes), pero también puede generar orientaciones que contrarrestan su efecto movilizador, requiriendo control estadístico para revelar su verdadero impacto. La evidencia visual confirma que la relación educación-protesta no puede entenderse sin considerar las actitudes políticas como mediadoras y supresoras simultáneas.

```{r}
#| warning: false
#| message: false
#| echo: false

library(gt)

comparacion_educacion %>%
  mutate(
    term = gsub("educ_cat_unordered", "", term),
    sig_total = ifelse(p_total < 0.05, "***", ""),
    sig_directo = ifelse(p_directo < 0.05, "***", "")
  ) %>%
  select(
    `Nivel Educativo` = term,
    `Efecto Total` = estimate_total,
    `Sig.` = sig_total,
    `Efecto Directo` = estimate_directo,
    `Sig. ` = sig_directo,
    `Efecto Indirecto` = efecto_indirecto,
    `% Mediado` = prop_mediada
  ) %>%
  gt() %>%
  tab_header(
    title = "Análisis de Mediación: Educación → Protesta",
    subtitle = "Comparación de efectos totales vs. directos"
  ) %>%
  fmt_number(
    columns = c(`Efecto Total`, `Efecto Directo`, `Efecto Indirecto`),
    decimals = 3
  ) %>%
  fmt_number(
    columns = `% Mediado`,
    decimals = 1
  ) %>%
  cols_align(
    align = "center",
    columns = everything()
  ) %>%
  cols_align(
    align = "left",
    columns = `Nivel Educativo`
  )
```

Esta tabla de análisis de mediación revela patrones fascinantes y complejos que van más allá de la mediación tradicional, mostrando evidencia sustancial de supresión estadística en los efectos educativos. Los efectos principales de educación muestran tres patrones distintos: (1) mediación tradicional en educación media incompleta (-0.637 a -0.419, 34.3% mediado), donde las variables actitudinales explican parte del efecto negativo; (2) supresión estadística en educación técnica y universitaria, donde los efectos se intensifican al controlar por actitudes (técnica completa: 0.271 a 0.578, -113.2% "mediado"; universitaria incompleta: 0.553 a 1.106, -100% "mediado"); y (3) revelación de efectos ocultos en niveles que no eran significativos originalmente pero emergen como significativos tras controlar por mediadores. Esto sugiere que los grupos de educación superior tienen orientaciones actitudinales (mayor percepción de justicia, identificación de clase alta) que normalmente reducirían su participación contestataria, pero una vez controladas estas actitudes conservadoras, emerge su verdadero potencial movilizador basado en recursos cívicos y capacidades políticas.

Los términos de interacción con movilidad muestran variabilidad extrema (desde -733.2% hasta 1,130.7% de "mediación"), reflejando la inestabilidad estadística de estas interacciones que no eran significativas en el modelo original. Los valores extremos como técnica superior completa × movilidad lineal (-733.2%) o media incompleta × movilidad cuadrática (1,130.7%) indican coeficientes muy pequeños en el denominador que generan porcentajes inflados, confirmando que estos efectos son estadísticamente poco confiables. La ausencia de valores (NA) para universitaria completa y postgrado en el componente cúbico refleja problemas de identificación del modelo debido a insuficiente variación muestral. El patrón general confirma que las variables actitudinales no solo median los efectos educativos sino que actúan como supresores estadísticos, revelando que la educación opera de forma contradictoria: mientras proporciona recursos para la movilización, también socializa actitudes que pueden inhibir la participación en protestas, requiriendo descomposición estadística para comprender su efecto neto

## Resumen Ejecutivo: Hallazgos Principales

Este apartado sintetiza los hallazgos centrales de los análisis de H1 (no linealidad educativa) y H2 (movilidad social), proporcionando un panorama integrado de cómo la educación y la movilidad social determinan la participación en protestas en Chile.

### Decisiones de modelos óptimos

| Hipótesis | Modelo Final | Decisión | Justificación |
|-----------|--------------|----------|---------------|
| **H1: No linealidad** | M4 Full (Educación Categórica) | **RECHAZAR H1** | Patrón mayormente ascendente y lineal. Completar educación AUMENTA (no disminuye) participación. |
| **H2: Interacción Movilidad** | M5 Aditivo (Educ + Movilidad) | **RECHAZAR H2** | LRT no significativo (p=0.365). Educación y movilidad operan independientemente. |

### Hallazgos sustantivos clave

#### **1. Efecto de la Educación** (predictor dominante)

**Patrón empírico**:
- Educación media incompleta o menos: -0.61*** (baseline negativo)
- Técnica superior incompleta: 0.44*
- Técnica superior completa: 0.73***
- Universitaria incompleta: 1.03***
- Universitaria completa: 1.23*** (máximo efecto)

**Magnitud**: Rango total de ~15-16 puntos porcentuales (de ~5% a ~21%)

**Interpretación**:
- Relación **mayormente lineal y ascendente**
- Cada nivel educativo adicional incrementa participación
- Efecto particularmente fuerte en educación universitaria completa
- **Mecanismo principal**: Recursos cívicos (habilidades, conocimiento, redes)

**Teorías confirmadas**: ✅ Civic voluntarism / ✅ Capital político

**Teorías rechazadas**: ❌ Frustración educativa (incompleta > completa)

#### **2. Efecto de la Movilidad Social** (secundario pero significativo)

**Patrón empírico** (desde M5 Aditivo):
- Término lineal: **-0.26*** (p < 0.05)**
- Mayor movilidad ascendente → MENOR participación en protestas

**Magnitud**: Rango de ~4-5 puntos porcentuales

**Interpretación**:
- Ascenso social **integra** al sistema político
- Efecto **uniforme** across niveles educativos (no condicional)
- Destino educativo (dónde llegas) importa 3x más que trayectoria (de dónde vienes)

**Mecanismo principal**: Integración social y percepción de meritocracia

**Teorías confirmadas**: ✅ Integración social

**Teorías rechazadas**: ❌ Frustración relativa / ❌ Expectativas frustradas

#### **3. Variables Políticas** (predictores más fuertes)

| Variable | Coeficiente | Interpretación |
|----------|-------------|----------------|
| **Interés político** | +0.53*** | Predictor MÁS fuerte (incluso más que educación) |
| **Ideología** | -0.21*** | Derecha reduce protesta consistentemente |
| **Confianza institucional** | -0.08 (ns) | No significativo |
| **Eficacia política** | +0.05 (ns) | No significativo |

#### **4. Efectos Temporales** (contexto político crítico)

| Año | Coeficiente | Contexto |
|-----|-------------|----------|
| 2016 | (Referencia) | Baseline pre-estallido |
| 2017-2018 | -0.64*** a -0.71*** | Disminución participación |
| **2019** | **+0.66***  | **Estallido social - ÚNICO AÑO POSITIVO** |
| 2022-2023 | -0.64*** a -0.96*** | Retorno a niveles bajos post-crisis |

**Implicación**: 2019 representa un evento transformador que movilizó transversalmente, independiente de educación o movilidad social.

### Comparación de magnitudes (efectos marginales)

Ordenando predictores por fuerza de efecto sobre probabilidad de protestar:

1. **Interés político** (bajo → alto): ~+25 pp
2. **Año 2019** (vs 2016): ~+20 pp  
3. **Educación** (media incompleta → postgrado): ~+15-16 pp
4. **Ideología** (izquierda → derecha): ~-10 pp
5. **Movilidad social** (descendente → ascendente alta): ~-5 pp
6. **Edad** (por cada 10 años): ~-2 pp

**Conclusión**: Las actitudes políticas (interés, ideología) y el contexto temporal (2019) dominan sobre factores socioestructurales (educación, movilidad).

### Implicaciones teóricas integradas

#### **Para teorías de participación política**:

1. **Recursos cívicos dominan sobre frustración**: La educación opera principalmente capacitando (no radicalizando por frustración)

2. **Motivación > Capacidad**: El interés político predice más fuertemente que la educación alcanzada

3. **Contexto político es crucial**: El estallido social (2019) eclipsó diferencias socioestructurales, movilizando transversalmente

4. **Mecanismos causales separados**: Educación (recursos) y movilidad (integración) operan independientemente, no interactivamente

#### **Para estudios de movilización en Chile**:

1. **Educación universitaria como factor clave**: El "umbral universitario" (especialmente completar grado) es crítico

2. **Ascenso social modera protesta**: La movilidad ascendente reduce participación, sugiriendo satisfacción con oportunidades del sistema

3. **2019 como evento nivelador**: Crisis políticas pueden activar participación más allá de ventajas educativas individuales

### Limitaciones y consideraciones

1. **Causalidad**: Modelos transversales repetidos no permiten inferencia causal estricta

2. **Muestra reducida H2**: Análisis de movilidad pierde ~20% de casos por datos faltantes de educación parental

3. **Mediación preliminar**: Análisis de mediación limitado por disponibilidad de variables actitudinales (N=3,723)

4. **Generalización**: Hallazgos específicos al contexto chileno 2016-2023 (ciclo de protestas único)

### Próximos pasos analíticos

1. ✅ **Robustez**: Modelos alternativos y diagnósticos (siguiente sección)
2. ⏭️ **Heterogeneidad**: ¿Efectos varían por cohorte generacional o región?
3. ⏭️ **Mecanismos**: Profundizar análisis de mediación con más variables
4. ⏭️ **Intensidad**: Analizar frecuencia de participación (no solo binario)

---

# Robutez y Diagnósticos

### Modelos Alternativos

```{r}
#| warning: false
#| message: false
#| echo: false


# A) Variable continua (años de educación)
mod_alt1_continua <- glmmTMB(
  protesta_dummy ~ educ_years * movilidad_years + 
    edad + mujer + ideologia_std + factor(year) +
    (1 | idencuesta),
  data = elsoc_final_2,
  family = binomial(link = "logit"))

screenreg(mod_alt1_continua)

# B) Solo post-estallido (2019+)
mod_alt2_postestallido <- glmmTMB(
  protesta_dummy ~ educ_cat_unordered * movilidad_cat_unordered +
    edad + mujer + ideologia_std +
    (1 | idencuesta),
  data = elsoc_final_2 %>% filter(year >= 2019),
  family = binomial(link = "logit")
)

screenreg(mod_alt2_postestallido)
```

El Modelo Alternativo 1 utiliza variables continuas (años de educación y años de movilidad) en lugar de categóricas, proporcionando una perspectiva complementaria que confirma los hallazgos principales pero con interpretaciones más directas. Los resultados muestran un efecto principal positivo y robusto de la educación (0.17, p < 0.001), indicando que cada año adicional de educación incrementa las log-odds de participar en protestas en 0.17, equivalente a un aumento del 18.5% en las odds. Este efecto lineal positivo es consistente con el gradiente educativo observado en los modelos categóricos, aunque obviamente no captura las no linealidades específicas entre tipos de educación que revelaron los modelos anteriores. El efecto de movilidad social es negativo (-0.10, p < 0.01), confirmando que cada año adicional de movilidad ascendente reduce la participación en protestas, consistent con teorías de integración social donde el ascenso genera mayor identificación con el sistema establecido.

Crucialmente, el modelo detecta una interacción significativa entre educación y movilidad (0.01, p < 0.05), sugiriendo que el efecto de la educación se intensifica ligeramente con mayor movilidad ascendente. Sin embargo, esta interacción es substantivamente pequeña (0.01) y contrasta con el rechazo de interacciones en los modelos categóricos, posiblemente reflejando diferencias en poder estadístico o en la especificación del modelo. El ajuste del modelo (AIC: 9,946) es comparable al modelo categórico aditivo (AIC: 9,698), indicando capacidad predictiva similar. Las variables de control mantienen los efectos esperados, y los efectos temporales replican el patrón conocido con 2019 como único año positivo. Este modelo alternativo refuerza la robustez de los hallazgos principales sobre efectos positivos de educación y negativos de movilidad, aunque sacrifica la capacidad de detectar patrones no lineales específicos que emergen cuando se distingue entre tipos de educación técnica versus universitaria.

El Modelo Alternativo 2 se enfoca exclusivamente en el período post-estallido social (2019 en adelante), proporcionando una perspectiva crucial sobre si los patrones educativos y de movilidad se mantienen durante el período de mayor activación política en Chile reciente. Los resultados revelan continuidad en los efectos educativos principales pero con algunas modificaciones importantes: educación media incompleta mantiene su efecto negativo (-0.50, p < 0.01), mientras que técnica superior incompleta emerge como el nivel con mayor efecto positivo (0.63, p < 0.01), superando incluso a universitaria incompleta (0.57, p < 0.01). Notably, postgrado pierde significancia estadística (0.91, no significativo), posiblemente reflejando menor variación en este grupo durante el período de crisis o menor poder estadístico debido al tamaño muestral reducido (6,952 vs 12,018 observaciones). El efecto de movilidad se intensifica sustancialmente: el término lineal aumenta de -0.26 (modelo completo) a -0.70 (p < 0.05), sugiriendo que durante períodos de alta movilización social, los efectos de integración por movilidad ascendente se vuelven más pronunciados.

La ausencia generalizada de interacciones significativas en este modelo (todas las interacciones son no significativas) refuerza el rechazo de la hipótesis H2 incluso durante el período de mayor activación política, cuando teóricamente podrían esperarse efectos condicionales más pronunciados. El modelo presenta los mismos problemas de identificación que el modelo completo (eliminación de términos por colinealidad), pero con un AIC proporcionalmente similar considerando el tamaño muestral. El intercepto más alto (1.76 vs 0.54 en modelo completo) refleja los niveles generalmente elevados de participación durante el estallido social. Las variables de control mantienen direcciones esperadas, aunque el efecto de género se reduce y pierde significancia, posiblemente indicando menor brecha de género en participación durante períodos de crisis. Este análisis de robustez temporal confirma que los patrones fundamentales de educación y movilidad no son específicos del período de normalidad política sino que se mantienen durante coyunturas críticas, aunque con algunas intensificaciones en las magnitudes de los efectos.

## Diagnósticos de verificación

```{r}
#| warning: false
#| message: false
#| echo: false
#| results: false


# Para glmmTMB el diagnóstico es diferente
library(glmmTMB)

# Ver si convergió
mod6_h2_interaccion$sdr$pdHess  # Debe ser TRUE

# Mensajes de convergencia
mod6_h2_interaccion$fit$convergence  # Debe ser 0

# Ver warnings completos
summary(mod6_h2_interaccion)
```


```{r}
#| warning: false
#| message: false
#| echo: false

library(car)

# Extraer solo efectos fijos
fixed_formula <- formula(mod6_h2_interaccion, fixed.only = TRUE)

# O manualmente crear modelo lineal temporal
data_vif <- elsoc_final_2 %>% 
  filter(!is.na(movilidad_cat))

# Modelo lineal simple para VIF (solo efectos fijos)
mod_temp <- lm(
  protesta_dummy ~ educ_cat_unordered + movilidad_cat_unordered +
    edad + edad_cuadratica + mujer + ideologia_std + interes_politica + 
    factor(year),
  data = data_vif
)

# Calcular VIF
vif_vals <- vif(mod_temp)
print(vif_vals)
```

```{r}
#| warning: false
#| message: false
#| echo: false

library(DHARMa)  # Mejor paquete para modelos mixtos

# Crear residuos simulados
sim_residuals <- simulateResiduals(
  fittedModel = mod6_h2_interaccion, 
  n = 1000,  # Número de simulaciones
  plot = FALSE
)

# Diagnósticos visuales completos
plot(sim_residuals)

# Tests específicos
testUniformity(sim_residuals)  # Test de uniformidad
testDispersion(sim_residuals)   # Test de sobredispersión
testOutliers(sim_residuals)     # Test de outliers
testZeroInflation(sim_residuals) # Test de zero-inflation

# Gráficos individuales
plotQQunif(sim_residuals)       # QQ plot
plotResiduals(sim_residuals)    # Residuos vs predichos
```

Los gráficos de diagnóstico proporcionan una evaluación comprehensiva de la calidad del ajuste del modelo de regresión logística multinivel, revelando un buen ajuste que valida la especificación del modelo final. El QQ plot de residuos (primer gráfico) muestra una alineación casi perfecta entre los residuos observados y los esperados bajo el modelo teórico, con todos los puntos siguiendo estrechamente la línea diagonal roja. El test de Kolmogorov-Smirnov confirma que no hay desviación significativa de la distribución esperada (p = 0.654), mientras que el test de outliers también es no significativo (p = 0.183), indicando ausencia de valores atípicos problemáticos. El gráfico de residuos versus predichos (panel superior derecho) muestra una distribución homogénea sin patrones sistemáticos, y crucialmente, el test de dispersión no detecta sobredispersión (p = 0.346), confirmando que el modelo binomial es apropiado para estos datos.

Los tests de uniformidad y sobredispersión (histogramas) proporcionan evidencia adicional de la calidad del modelo a través de simulaciones Monte Carlo. El histograma de dispersión muestra que el valor observado del modelo (línea roja vertical) cae bien dentro de la distribución de valores simulados bajo la hipótesis nula de ajuste correcto, con un p-valor bilateral de 0.346 que confirma ausencia de sobredispersión. El test de zero-inflation indica que el modelo no sufre de exceso de ceros (p = 0.206), validando que la estructura binomial simple es suficiente sin necesidad de modelos de inflación de ceros. La distribución uniforme de residuos confirma que el modelo captura adecuadamente la variabilidad en los datos sin patrones residuales sistemáticos. En conjunto, estos diagnósticos validan que el modelo final (Modelo 5 Aditivo) cumple con todos los supuestos estadísticos necesarios para modelos logísticos multinivel, proporcionando confianza en la validez de las inferencias sobre los efectos de educación y movilidad social en la participación en protestas.

## Tablas de Resultados

```{r}
#| warning: false
#| message: false
#| echo: false

library(modelsummary)

# Crear tabla comparativa
modelsummary(
  list(
    "Pooled" = mod_pooled,
    "RE Simple" = mod1_educ_simple,
    "RE Demo" = mod2_educ_demo,
    "RE Full (H1)" = mod3_h1_full,
    "RE Aditivo" = mod5_aditivo,
    "RE Interacción (H2)" = mod6_h2_interaccion
  ),
  output = "gt",
  stars = c('*' = .05, '**' = .01, '***' = .001),
  coef_rename = c(
    "(Intercept)" = "Intercepto",
    "edad" = "Edad",
    "mujer" = "Mujer",
    "ideologia_std" = "Ideología (izq-der)"
  ),
  gof_map = c("nobs", "aic", "bic"),
  notes = "Fuente: Elaboración propia con datos ELSOC (2016-2023). Errores estándar robustos por cluster en paréntesis."
)

```


```{r}
#| warning: false
#| message: false
#| echo: false

# Coeficientes de educación
educ_coefs <- tibble(
  Nivel = rep(c("Media incomp-", "Téc sup incomp", "Téc sup comp", 
                "Univ incomp", "Univ comp", "Postgrado"), 6),
  Modelo = rep(c("Pooled", "RE Simple", "RE Demo", "RE Full", "RE Aditivo", "RE Interacción"), each = 6),
  Coef = c(
    # Pooled
    -0.036, 0.042, 0.038, 0.107, 0.076, 0.160,
    # RE Simple
    -0.869, 0.834, 0.498, 1.432, 1.069, 1.630,
    # RE Demo
    -0.534, 0.547, 0.441, 0.984, 0.890, 1.544,
    # RE Full
    -0.598, 0.397, 0.328, 0.686, 0.586, 0.986,
    # RE Aditivo
    -0.610, 0.406, 0.320, 0.627, 0.609, 0.994,
    # RE Interacción
    -0.637, 0.319, 0.271, 0.553, 0.135, 0.509
  ),
  Sig = c(
    # Pooled
    "***", "*", "***", "***", "***", "***",
    # RE Simple
    "***", "***", "***", "***", "***", "***",
    # RE Demo
    "***", "***", "***", "***", "***", "***",
    # RE Full
    "***", "*", "**", "***", "***", "***",
    # RE Aditivo
    "***", "**", "**", "***", "***", "***",
    # RE Interacción
    "***", "", "", "***", "", ""
  )
)

# Gráfico de evolución de coeficientes
ggplot(educ_coefs, aes(x = Modelo, y = Coef, 
                        group = Nivel, color = Nivel)) +
  geom_line(size = 1.2) +
  geom_point(size = 3) +
  geom_hline(yintercept = 0, linetype = "dashed") +
  labs(
    title = "Evolución de Coeficientes Educativos por Modelo",
    subtitle = "Los coeficientes se reducen al agregar controles",
    y = "Coeficiente (log-odds)",
    x = NULL,
    color = "Nivel Educativo"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

El gráfico "Evolución de Coeficientes Educativos por Modelo" ilustra de manera clara cómo los efectos educativos se transforman progresivamente a medida que se agregan controles estadísticos, revelando la robustez y estabilidad de los patrones fundamentales. La línea amarilla (Postgrado) muestra la trayectoria más dramática: comienza con el coeficiente más alto en el modelo pooled (aproximadamente 0.16), se eleva sustancialmente en los modelos de efectos aleatorios simples y demográficos (alcanzando su pico de 1.6), y luego se estabiliza en valores moderados (alrededor de 1.0) una vez incorporadas las variables actitudinales y de movilidad. Esta evolución sugiere que el efecto del postgrado es robusto pero se ve inflado cuando no se controlan adecuadamente las características individuales y actitudinales que correlacionan tanto con el nivel educativo como con la participación política.

Las líneas de educación universitaria (completa e incompleta, en azul y magenta respectivamente) muestran patrones similares pero con magnitudes diferentes, manteniéndose consistentemente por encima de la línea de referencia (cero) a través de todos los modelos, lo que confirma su efecto positivo robusto sobre la participación en protestas. Particularmente notable es la estabilidad relativa de estos efectos una vez controladas las variables demográficas, sugiriendo que los efectos universitarios no son meramente artefactos de diferencias de edad o género. Por el contrario, la línea roja (Media incompleta o menos) permanece consistentemente en territorio negativo a través de todos los modelos, confirmando que este grupo tiene menor probabilidad de participar en protestas independientemente de los controles incluidos. Los niveles de educación técnica (líneas verde y turquesa) muestran trayectorias más modestas pero positivas, validando la hipótesis de que la educación post-secundaria, independientemente del tipo, incrementa la participación política. El patrón general del gráfico confirma que los efectos educativos no son espurios sino que reflejan diferencias genuinas en participación política que trascienden características demográficas y actitudinales.

```{r}
#| warning: false
#| message: false
#| echo: false

library(gt)

# Tabla comparativa de modelos clave
tabla_final <- tibble(
  Variable = c(
    "Educación", "  Media incompleta o menos", "  Universitaria incompleta", 
    "  Universitaria completa", "  Postgrado",
    "Movilidad (lineal)", "Edad", "Mujer", 
    "Ideología (izq-der)", "Interés político",
    "", "N observaciones", "AIC", "BIC", "SD efectos aleatorios"
  ),
  `RE Simple` = c(
    "", "-0.869***", "1.432***", "1.069***", "1.630***",
    "", "", "", "", "",
    "", "20,052", "16,111.9", "16,175.2", "1.430"
  ),
  `RE Full (H1)` = c(
    "", "-0.598***", "0.686***", "0.586***", "0.986***",
    "", "-0.044***", "-0.205**", "-0.214***", "0.456***",
    "", "12,648", "10,009.6", "10,158.5", "1.370"
  ),
  `RE Aditivo` = c(
    "", "-0.610***", "0.627***", "0.609***", "0.994***",
    "-0.260*", "-0.043***", "-0.222**", "-0.217***", "0.426***",
    "", "12,018", "9,697.8", "9,853.0", "1.360"
  ),
  `RE Interacción (H2)` = c(
    "", "-0.637***", "0.553***", "0.135", "0.509",
    "-0.313", "-0.043***", "-0.222**", "-0.218***", "0.427***",
    "", "12,018", "9,712.4", "9,986.0", "1.353"
  )
)

tabla_final %>%
  gt() %>%
  tab_header(
    title = "Modelos de Regresión Logística Multinivel",
    subtitle = "Variable dependiente: Participación en protestas (dummy)"
  ) %>%
  tab_footnote(
    footnote = "* p < 0.05, ** p < 0.01, *** p < 0.001"
  ) %>%
  tab_source_note(
    source_note = "Fuente: Elaboración propia con datos ELSOC (2016-2023)"
  ) %>%
  cols_align(
    align = "left",
    columns = Variable
  ) %>%
  cols_align(
    align = "center",
    columns = 2:5
  )
```

# Conclusiones principales modelos exploratorios:

- Modelo óptimo: RE Aditivo (menor AIC)
- Hipótesis H2 rechazada: La interacción NO mejora el modelo
- Efectos robustos: Educación, ideología e interés político son predictores consistentes
- Movilidad social: Efecto lineal negativo en modelo aditivo
- Mediación: Variables actitudinales median ~40-50% del efecto educativo

Para evaluar la hipótesis H1 sobre el efecto de la educación, se estimó una serie de modelos logísticos multinivel. El Modelo 2 (RE Full) muestra que, controlando variables demográficas, actitudinales y temporales, la educación mantiene un efecto positivo robusto sobre la participación en protestas. El gradiente educativo es claro: desde un efecto negativo en educación media incompleta o menos (β = -0.598, p < 0.001) hasta un efecto positivo máximo en postgrado (β = 0.986, p < 0.001), pasando por niveles intermedios significativos en educación universitaria.
La inclusión de ideología política e interés político (Modelo 3) reduce los coeficientes educativos aproximadamente 40-50% respecto al modelo demográfico básico (Modelo 2), sugiriendo mediación parcial por variables actitudinales. Sin embargo, los efectos educativos se mantienen significativos, indicando que la educación opera tanto directamente como a través de actitudes políticas.

Para evaluar la hipótesis H2 sobre movilidad social, se estimaron dos modelos adicionales: uno con efectos aditivos de educación y movilidad (Modelo 4) y otro con interacciones entre ambas (Modelo 5). El Modelo 4 muestra un efecto lineal negativo de la movilidad social (β = -0.260, p < 0.05), consistente con la hipótesis de integración: mayor movilidad ascendente se asocia con menor participación en protestas, controlando nivel educativo alcanzado.
El modelo con interacciones (Modelo 5) no mejora el ajuste respecto al modelo aditivo (ΔAIC = +14.6; ΔBIC = +133.0), y solo una de las 18 interacciones resulta significativa. Por tanto, se rechaza la hipótesis H2 de que el efecto de la educación varía según la trayectoria de movilidad social. Los datos apoyan un modelo donde educación y movilidad tienen efectos independientes y aditivos sobre la protesta.

La tabla comparativa de modelos revela una progresión sistemática desde especificaciones básicas hasta el modelo óptimo, confirmando la robustez de los hallazgos educativos. La evolución desde el modelo RE Simple (AIC: 16,112) hasta el RE Aditivo (AIC: 9,698) demuestra mejoras sustanciales en ajuste estadístico mediante la incorporación progresiva de controles demográficos, actitudinales y de movilidad. Crucialmente, los efectos educativos se mantienen significativos y en la misma dirección a través de todas las especificaciones, aunque con magnitudes reducidas: el efecto de universitaria incompleta decrece de 1.432 en el modelo simple a 0.627 en el modelo aditivo, mientras que postgrado se reduce de 1.630 a 0.994. Esta atenuación controlada indica que los efectos educativos no son espurios sino que reflejan mediación parcial por variables demográficas y actitudinales, manteniendo efectos directos sustanciales sobre la participación contestataria.

El Modelo RE Aditivo emerge como especificación óptima por múltiples criterios convergentes: menor AIC (9,698), balance favorable entre AIC y BIC (9,853), y significancia estadística de todos los predictores principales. La introducción de movilidad social (-0.260, p < 0.05) mejora el poder explicativo sin comprometer la estabilidad de los efectos educativos, confirmando que ambos constructos aportan información independiente para predecir participación política. El modelo RE Interacción (H2), pese a incluir 16 términos adicionales, no mejora el ajuste (ΔAIC = +14.6) y genera pérdida de significancia en varios niveles educativos (universitaria completa y postgrado), evidenciando sobreajuste estadístico que justifica su rechazo.

El rechazo definitivo de la hipótesis H2 tiene profundas implicaciones teóricas. Los datos chilenos no apoyan teorías de frustración relativa que predicen efectos educativos condicionales según trayectorias de movilidad, sino que favorecen modelos aditivos donde educación y movilidad operan a través de mecanismos causales independientes. Esto es consistente con teorías de recursos cívicos (Brady et al., 1995) que enfatizan la educación como proveedora universal de habilidades políticas, independiente de la trayectoria social experimentada. Simultáneamente, el efecto negativo robusto de la movilidad ascendente (-0.260) apoya teorías de integración social: quienes experimentan ascenso desarrollan mayor identificación sistémica, reduciendo incentivos contestatarios independientemente de su nivel educativo final. Esta separación analítica entre efectos educativos (recursos) y efectos de movilidad (integración) proporciona evidencia empírica para modelos teóricos que distinguen entre mecanismos cognitivos/instrumentales versus mecanismos identitarios/normativos en la participación política.

```{r}
#| warning: false
#| message: false
#| echo: false


# Gráfico 2: Probabilidades predichas H2
plot_model(mod6_h2_interaccion,
           type = "pred",
           terms = c("educ_cat_unordered", "movilidad_cat_unordered"),
           title = "Interacción: Educación × Movilidad")

# Gráfico 3: Efectos marginales
plot_model(mod6_h2_interaccion,
           type = "int",
           title = "Efecto marginal de educación según movilidad")
```

Los gráficos de probabilidades predichas y efectos marginales proporcionan una visualización complementaria que confirma visualmente el rechazo de la hipótesis H2 sobre interacciones entre educación y movilidad social. El primer gráfico ("Interacción: Educación × Movilidad") muestra las probabilidades predichas para cada combinación de nivel educativo y tipo de movilidad, revelando patrones que carecen de coherencia teórica sistemática. Los intervalos de confianza son amplios y se superponen considerablemente entre diferentes tipos de movilidad dentro de cada nivel educativo, particularmente en los niveles de educación superior donde las diferencias entre trayectorias de movilidad son mínimas y estadísticamente no significativas. La ausencia de patrones divergentes claros entre las líneas de movilidad a medida que aumenta el nivel educativo confirma que no existe una interacción sustantiva entre estos predictores.

El segundo gráfico ("Efecto marginal de educación según movilidad") es prácticamente idéntico al primero, lo que refuerza la conclusión de que los efectos educativos son constantes across diferentes trayectorias de movilidad social. La superposición visual de los intervalos de confianza y la ausencia de pendientes divergentes entre tipos de movilidad validan estadísticamente el modelo aditivo como especificación correcta. Estos gráficos, generados desde el modelo de interacción saturado, demuestran que incluso cuando se permite máxima flexibilidad estadística, los datos no revelan patrones condicionales teóricamente interpretables. La evidencia visual converge con los tests estadísticos formales (LRT p = 0.365) para rechazar definitivamente H2, apoyando la conclusión de que educación y movilidad operan como predictores independientes de participación política contestataria, consistent con teorías que distinguen entre mecanismos de recursos cívicos versus integración social en la movilización política.

# Análisis Exploratorio: Justificación de Violencia

Esta sección analiza cómo la educación y la clase social se relacionan con actitudes hacia la violencia en contextos de protesta, considerando además el efecto de la participación en protestas. El análisis se estructura en dos partes principales:

1. **Violencia y Educación**: Examina si el efecto de la educación sobre actitudes hacia la violencia varía según participación en protestas
2. **Violencia y Clase Social (EGP)**: Evalúa si la posición de clase modera la relación entre protesta y actitudes hacia la violencia

**Contexto teórico**: Durante el estallido social chileno de 2019, el debate sobre la legitimidad de la violencia en protestas fue central. Diferentes grupos sociales pueden tener actitudes diferenciadas sobre la justificación de la violencia, tanto la ejercida por manifestantes como la violencia estatal (Carabineros).

**Variables de violencia en ELSOC**:
- `justif_violencia_protesta`: Índice de justificación de violencia en manifestaciones (manifestantes)
- `justif_violencia_estatal`: Índice de justificación de violencia policial (Carabineros)
- `justifica_violencia_protesta_dummy`: Variable dicotómica (justifica = 1)
- `justifica_violencia_estatal_dummy`: Variable dicotómica (justifica = 1)

## Parte 1: Violencia, Educación y Protesta

### Pregunta de investigación

¿Cómo se relacionan la educación, la participación en protestas y las actitudes hacia la violencia en manifestaciones?

**Hipótesis exploratorias**:
- **H_VE1**: Mayor educación reduce la justificación de violencia en protestas (efecto civilizatorio)
- **H_VE2**: La participación en protestas modera esta relación (quienes protestan pueden justificar más violencia independientemente de su educación)
- **H_VE3**: El efecto educativo es más fuerte para violencia estatal que para violencia en protestas

### Exploración descriptiva

```{r}
#| warning: false
#| message: false
#| echo: false
#| label: tbl-violencia-educacion-desc
#| tbl-cap: "Justificación de violencia según nivel educativo"

library(dplyr)
library(gt)

# Descriptivos por nivel educativo
violencia_educ_desc <- elsoc_final_2 %>%
  filter(!is.na(educ_cat_unordered) & !is.na(justif_violencia_protesta)) %>%
  group_by(educ_cat_unordered) %>%
  summarise(
    N = n(),
    `Just. Violencia Protesta (Media)` = round(mean(justif_violencia_protesta, na.rm = TRUE), 2),
    `Just. Violencia Protesta (DE)` = round(sd(justif_violencia_protesta, na.rm = TRUE), 2),
    `Just. Violencia Estatal (Media)` = round(mean(justif_violencia_estatal, na.rm = TRUE), 2),
    `Just. Violencia Estatal (DE)` = round(sd(justif_violencia_estatal, na.rm = TRUE), 2),
    `% Justifica Viol. Protesta` = round(100 * mean(justifica_violencia_protesta_dummy, na.rm = TRUE), 1),
    `% Justifica Viol. Estatal` = round(100 * mean(justifica_violencia_estatal_dummy, na.rm = TRUE), 1)
  ) %>%
  gt() %>%
  tab_header(
    title = "Actitudes hacia la violencia según nivel educativo",
    subtitle = "Índices y porcentajes de justificación"
  ) %>%
  cols_align(
    align = "center",
    columns = -educ_cat_unordered
  ) %>%
  tab_footnote(
    footnote = "Índices en escala 1-5. Dummy = 1 si justifica (>1 en escala)"
  )

violencia_educ_desc
```

```{r}
#| warning: false
#| message: false
#| echo: false
#| label: fig-violencia-educacion
#| fig-cap: "Justificación de violencia según educación y participación en protestas"
#| fig-height: 6
#| fig-width: 10

library(ggplot2)
library(patchwork)

# Panel A: Violencia en protestas
plot_viol_protesta <- elsoc_final_2 %>%
  filter(!is.na(educ_cat_unordered) & !is.na(protesta_dummy)) %>%
  group_by(educ_cat_unordered, Protesta = factor(protesta_dummy, 
                                                   labels = c("No protestó", "Protestó"))) %>%
  summarise(
    Media = mean(justif_violencia_protesta, na.rm = TRUE),
    SE = sd(justif_violencia_protesta, na.rm = TRUE) / sqrt(n()),
    .groups = "drop"
  ) %>%
  ggplot(aes(x = educ_cat_unordered, y = Media, fill = Protesta)) +
  geom_col(position = position_dodge(width = 0.8), width = 0.7) +
  geom_errorbar(aes(ymin = Media - 1.96*SE, ymax = Media + 1.96*SE),
                position = position_dodge(width = 0.8), width = 0.3) +
  scale_fill_manual(values = c("No protestó" = "#0073C2FF", "Protestó" = "#EFC000FF")) +
  labs(
    title = "A) Justificación de Violencia en Protestas",
    x = "Nivel Educativo",
    y = "Justificación (escala 1-5)"
  ) +
  theme_minimal(base_size = 11) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        legend.position = "bottom")

# Panel B: Violencia estatal
plot_viol_estatal <- elsoc_final_2 %>%
  filter(!is.na(educ_cat_unordered) & !is.na(protesta_dummy)) %>%
  group_by(educ_cat_unordered, Protesta = factor(protesta_dummy, 
                                                   labels = c("No protestó", "Protestó"))) %>%
  summarise(
    Media = mean(justif_violencia_estatal, na.rm = TRUE),
    SE = sd(justif_violencia_estatal, na.rm = TRUE) / sqrt(n()),
    .groups = "drop"
  ) %>%
  ggplot(aes(x = educ_cat_unordered, y = Media, fill = Protesta)) +
  geom_col(position = position_dodge(width = 0.8), width = 0.7) +
  geom_errorbar(aes(ymin = Media - 1.96*SE, ymax = Media + 1.96*SE),
                position = position_dodge(width = 0.8), width = 0.3) +
  scale_fill_manual(values = c("No protestó" = "#0073C2FF", "Protestó" = "#EFC000FF")) +
  labs(
    title = "B) Justificación de Violencia Estatal (Carabineros)",
    x = "Nivel Educativo",
    y = "Justificación (escala 1-5)"
  ) +
  theme_minimal(base_size = 11) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        legend.position = "bottom")

# Combinar gráficos
plot_viol_protesta + plot_viol_estatal +
  plot_annotation(
    title = "Actitudes hacia la violencia según educación y experiencia de protesta",
    caption = "Fuente: ELSOC 2016-2023. Barras de error: IC 95%"
  )
```

**Interpretación preliminar de gráficos**: [Describir patrones observados una vez que se generen]

### Modelos de regresión

```{r}
#| warning: false
#| message: false
#| echo: false

# Modelo V1: Educación → Violencia en protesta
mod_v1_educ_protesta <- glmmTMB(
  justif_violencia_protesta ~ educ_cat_unordered + 
    edad + mujer + ideologia_std + 
    factor(year) +
    (1 | idencuesta),
  data = elsoc_final_2,
  family = gaussian())

# Modelo V2: + Participación en protesta
mod_v2_educ_protesta_particip <- glmmTMB(
  justif_violencia_protesta ~ educ_cat_unordered + protesta_dummy +
    edad + mujer + ideologia_std + 
    factor(year) +
    (1 | idencuesta),
  data = elsoc_final_2,
  family = gaussian())

# Modelo V3: + Interacción Educación × Protesta
mod_v3_educ_protesta_interact <- glmmTMB(
  justif_violencia_protesta ~ educ_cat_unordered * protesta_dummy +
    edad + mujer + ideologia_std + 
    factor(year) +
    (1 | idencuesta),
  data = elsoc_final_2,
  family = gaussian())

# Tabla comparativa
screenreg(list(mod_v1_educ_protesta, mod_v2_educ_protesta_particip, mod_v3_educ_protesta_interact),
          custom.model.names = c("V1: Solo Educación", "V2: + Protesta", "V3: Interacción"))
```

### Interpretación de resultados

#### 1. Efecto principal de la educación (Modelo V1)

Los resultados del Modelo V1 muestran efectos modestos de la educación sobre la justificación de violencia en protestas:

- **Técnica superior completa**: -0.09*** (vs. secundaria incompleta o menos)
- **Universitaria completa**: -0.03 (n.s.)

**Patrón inesperado**: Contrario a la hipótesis del "efecto civilizatorio", la educación universitaria completa NO reduce significativamente la justificación de violencia en protestas cuando se analiza sin considerar la participación. Solo la educación técnica superior completa muestra un efecto protector significativo, aunque pequeño (-0.09 puntos en escala 1-5).

**Variables de control importantes**:
- **Edad**: -0.01*** (personas mayores justifican menos la violencia)
- **Ideología**: -0.03*** (más a la derecha, menos justificación)
- **Año 2019**: -0.30*** (durante el estallido, MENOR justificación de violencia - resultado contraintuitivo que merece exploración)

#### 2. Efecto de participar en protestas (Modelo V2)

Al incluir `protesta_dummy`, emergen hallazgos importantes:

- **Protesta_dummy**: +0.31*** (efecto sustantivo y altamente significativo)
- **Educación universitaria completa**: cambia de -0.03 (n.s.) a -0.08*** (se vuelve significativa)
- **Técnica superior incompleta**: -0.10* (efecto se fortalece)

**Interpretación**: La participación en protestas es un **predictor muy fuerte** de justificar violencia en manifestaciones (+0.31 en escala 1-5). Más importante, al controlar por participación, los efectos educativos se clarifican: ahora sí observamos que mayor educación reduce la justificación de violencia, especialmente para educación universitaria completa (-0.08***).

**Implicación teórica**: El efecto "civilizatorio" de la educación **sí existe**, pero estaba confundido en el Modelo V1 porque las personas más educadas también participan más en protestas, y la participación aumenta la justificación.

#### 3. Interacciones Educación × Protesta (Modelo V3 - Clave)

El modelo de interacción revela el hallazgo más importante del análisis:

**Efectos principales (para quienes NO protestaron)**:
- Técnica superior incompleta: -0.13**
- Técnica superior completa: -0.12***
- Universitaria completa: -0.11***
- Protesta_dummy (para categoría de referencia educativa): +0.23***

**Términos de interacción (efecto ADICIONAL de protestar según nivel educativo)**:
- Técnica superior incompleta × Protesta: +0.22* 
- Técnica superior completa × Protesta: +0.12*
- Universitaria incompleta × Protesta: +0.08 (n.s.)
- Universitaria completa × Protesta: +0.13**

**Interpretación sustantiva crítica**:

Entre quienes **NO participaron** en protestas, la educación reduce la justificación de violencia (efectos principales negativos y significativos). Sin embargo, para quienes **SÍ protestaron**, este efecto protector de la educación se **neutraliza parcial o totalmente** por las interacciones positivas.

**Ejemplo de cálculo del efecto total**:
- Universitaria completa que NO protestó: -0.11*** (menos justificación que referencia)
- Universitaria completa que SÍ protestó: -0.11 + 0.23 + 0.13 = **+0.25** (¡MAYOR justificación que referencia!)

**Hallazgo central**: **La experiencia de participar en protestas invierte el efecto educativo**. La educación reduce la justificación de violencia solo entre observadores externos; entre participantes, la educación se asocia con MAYOR justificación, posiblemente porque desarrollan marcos interpretativos que legitiman la violencia táctica en contextos de represión o movilización intensiva.

#### 4. Mejora de ajuste del modelo

- AIC disminuye de 34,741 (V1) → 34,479 (V2) → 34,475 (V3)
- Log Likelihood mejora significativamente
- Las interacciones aportan información predictiva relevante

**Conclusión provisional sobre H_VE1 y H_VE2**:

✅ **H_VE2 confirmada**: La participación en protestas **modera fuertemente** el efecto de la educación  
⚠️ **H_VE1 matizada**: La educación reduce la justificación de violencia, pero **solo entre no-participantes**. Entre participantes, la educación se asocia con mayor justificación.

**Implicación teórica central**: El efecto "civilizatorio" de la educación depende críticamente de la **posición del actor** (observador vs participante). La participación genera experiencias que reconfiguran marcos morales sobre violencia política, proceso que es **más pronunciado** entre personas más educadas (posiblemente porque tienen mayor capacidad reflexiva para elaborar justificaciones ideológicas complejas).

---

### Test de interacción

```{r}
#| warning: false
#| message: false
#| echo: false

# LRT: ¿Protesta modera el efecto de educación?
lrt_violencia_educ <- anova(mod_v2_educ_protesta_particip, mod_v3_educ_protesta_interact)
print(lrt_violencia_educ)
```

**Interpretación del test de razón de verosimilitud (LRT)**:

- **χ² = 12.01, df = 4, p = 0.017** → Las interacciones educación × protesta son **estadísticamente significativas** al nivel 0.05
- La mejora en log-likelihood (-17,224 → -17,218) justifica la inclusión de 4 parámetros adicionales (las 4 interacciones)
- El AIC del modelo con interacciones (34,475) es menor que el modelo aditivo (34,479), confirmando mejor ajuste

**Conclusión**: Existe evidencia estadística robusta de que **la participación en protestas modera el efecto de la educación** sobre la justificación de violencia. El efecto protector de la educación observado en el Modelo V2 NO es uniforme, sino que depende críticamente de si la persona participó o no en protestas.

Este hallazgo tiene implicaciones teóricas importantes: sugiere que los **marcos interpretativos sobre violencia política** no se derivan simplemente del capital cultural educativo, sino de la **interacción entre recursos cognitivos (educación) y experiencias vividas (participación)**.

---

### Violencia estatal (comparación)

```{r}
#| warning: false
#| message: false
#| echo: false

# Modelo VE: Educación → Violencia estatal
mod_ve_educ_estatal <- glmmTMB(
  justif_violencia_estatal ~ educ_cat_unordered * protesta_dummy +
    edad + mujer + ideologia_std + 
    factor(year) +
    (1 | idencuesta),
  data = elsoc_final_2,
  family = gaussian())

# Comparación lado a lado
screenreg(list(mod_v3_educ_protesta_interact, mod_ve_educ_estatal),
          custom.model.names = c("Violencia en Protesta", "Violencia Estatal"))
```

### Comparación violencia en protestas vs. violencia estatal: Hallazgos clave

Los resultados revelan **patrones opuestos y teóricamente coherentes** entre ambos tipos de violencia, evidenciando que se trata de fenómenos diferenciados con determinantes sociales distintos.

#### 1. Efectos principales de educación: Direcciones opuestas

**Violencia en protestas** (manifestantes):
- Técnica superior completa: **-0.12***
- Universitaria completa: **-0.11***
- → Educación **reduce** justificación

**Violencia estatal** (Carabineros):
- Técnica superior completa: +0.03 (n.s.)
- Universitaria completa: +0.06 (n.s.)
- → Educación **NO reduce** (incluso leve tendencia positiva)

**Interpretación**: Entre no-participantes, la educación genera actitudes críticas hacia la violencia de manifestantes, pero **NO genera crítica equivalente hacia la violencia policial**. Esto sugiere que el capital cultural educativo puede incorporar sesgos hacia la legitimidad del monopolio estatal de la violencia.

#### 2. Efecto de participar en protestas: Inversión dramática

**Violencia en protestas**:
- Protesta_dummy (categoría ref.): **+0.23***
- → Participar **aumenta** justificación

**Violencia estatal**:
- Protesta_dummy (categoría ref.): **-0.04** (n.s.)
- → Participar **NO afecta** significativamente (para categoría de referencia)

**Interpretación crítica**: Quienes participan en protestas desarrollan mayor justificación de violencia en manifestaciones (+0.23), pero sorprendentemente **NO justifican menos la violencia policial** en el efecto principal (aunque ver interacciones abajo).

#### 3. Interacciones Educación × Protesta: El hallazgo más importante

**Violencia en protestas** (confirmando análisis previo):
- Universitaria completa × Protesta: **+0.13**
- → Universitarios que protestan justifican MÁS violencia

**Violencia estatal** (patrón INVERTIDO):
- Universitaria incompleta × Protesta: **-0.16**
- Universitaria completa × Protesta: **-0.18***
- → Universitarios que protestan justifican MENOS violencia policial

**Efecto total para universitarios completos que protestaron**:

- **Violencia en protestas**: -0.11 + 0.23 + 0.13 = **+0.25** (justifican más que categoría ref.)
- **Violencia estatal**: +0.06 + (-0.04) + (-0.18) = **-0.16** (justifican menos que categoría ref.)

#### 4. Interpretación teórica integradora: Dos marcos morales diferenciados

Los resultados sugieren que **participar en protestas genera una reconfiguración bidireccional de actitudes hacia la violencia política**, especialmente entre personas más educadas:

**Para universitarios participantes**:
1. **Mayor justificación** de violencia en manifestaciones (+0.25 efecto total)
   - Posible mecanismo: Elaboración de marcos de "violencia táctica legítima" frente a represión
   
2. **Menor justificación** de violencia estatal (-0.16 efecto total)
   - Posible mecanismo: Experiencia directa/indirecta de represión genera crítica al uso de fuerza policial

**Para universitarios NO participantes**:
1. **Menor justificación** de violencia en manifestaciones (-0.11)
2. Justificación **neutra/levemente positiva** de violencia estatal (+0.06)
   - Sesgo hacia legitimidad del orden establecido

#### 5. Variables de control: Patrones reveladores

**Ideología** (más derecha = valores positivos):
- Violencia en protestas: **-0.02*** (derecha justifica MENOS)
- Violencia estatal: **+0.05*** (derecha justifica MÁS)
- → Coherencia ideológica esperada

**Género** (mujer = 1):
- Violencia en protestas: -0.03 (n.s.)
- Violencia estatal: **-0.13*** (mujeres justifican MENOS violencia policial)
- → Hallazgo interesante: mujeres más críticas de violencia institucional

**Edad**:
- Violencia en protestas: **-0.01*** (mayores justifican menos)
- Violencia estatal: **+0.00*** (efecto prácticamente nulo pero técnicamente positivo)

**Año 2019** (estallido social):
- Violencia en protestas: **-0.30***
- Violencia estatal: **-0.40***
- → Durante el estallido, **MENOR justificación de AMBOS tipos de violencia**
- → Hallazgo contraintuitivo que requiere exploración: ¿saturación mediática de violencia generó rechazo generalizado?

#### 6. Ajuste de modelos: Violencia estatal es más variable

- **Violencia en protestas**: Var(intercepto individual) = 0.12
- **Violencia estatal**: Var(intercepto individual) = 0.20
- → Mayor heterogeneidad individual en actitudes hacia violencia policial (posiblemente por experiencias diferenciadas con Carabineros)

#### 7. Síntesis: Respuesta a H_VE3

✅ **H_VE3 FUERTEMENTE CONFIRMADA**: El efecto educativo es **cualitativamente diferente** entre violencia en protestas vs. estatal:

| Grupo | Violencia Protestas | Violencia Estatal |
|-------|---------------------|-------------------|
| Univ. completa SIN protesta | -0.11*** (críticos) | +0.06 (leve legitimación) |
| Univ. completa CON protesta | +0.25 (justifican) | -0.16 (críticos) |

**Conclusión teórica central**: 

La participación en protestas no solo modera el efecto de la educación, sino que **invierte su signo según el tipo de violencia**. Entre universitarios participantes emerge un marco moral diferenciado que:
1. Legitima violencia táctica en manifestaciones (posiblemente como resistencia)
2. Deslegitima violencia estatal institucional (experiencia de represión)

Entre universitarios no-participantes persiste un sesgo conservador que critica la violencia disruptiva pero tolera/legitima la violencia institucional.

Este hallazgo tiene implicaciones profundas sobre cómo las experiencias de movilización reconfiguran las fronteras morales sobre el uso de la fuerza en democracia.

---

## Parte 2: Violencia, Clase Social y Protesta

### Pregunta de investigación

¿Cómo se relacionan la clase social (EGP), la participación en protestas y las actitudes hacia la violencia?

**Hipótesis exploratorias**:
- **H_VC1**: Clases trabajadoras justifican más la violencia en protestas (alienación)
- **H_VC2**: Clases de servicio justifican más la violencia estatal (identificación con el orden)
- **H_VC3**: La clase modera la relación protesta-violencia

### Exploración descriptiva

```{r}
#| warning: false
#| message: false
#| echo: false
#| label: tbl-violencia-clase-desc
#| tbl-cap: "Justificación de violencia según clase social (EGP)"

# Descriptivos por clase social
violencia_clase_desc <- elsoc_final_2 %>%
  filter(!is.na(egp3) & !is.na(justif_violencia_protesta)) %>%
  group_by(egp3) %>%
  summarise(
    N = n(),
    `Just. Violencia Protesta` = round(mean(justif_violencia_protesta, na.rm = TRUE), 2),
    `DE` = round(sd(justif_violencia_protesta, na.rm = TRUE), 2),
    `Just. Violencia Estatal` = round(mean(justif_violencia_estatal, na.rm = TRUE), 2),
    `DE ` = round(sd(justif_violencia_estatal, na.rm = TRUE), 2),
    `% Justifica Viol. Protesta` = round(100 * mean(justifica_violencia_protesta_dummy, na.rm = TRUE), 1),
    `% Justifica Viol. Estatal` = round(100 * mean(justifica_violencia_estatal_dummy, na.rm = TRUE), 1)
  ) %>%
  gt() %>%
  tab_header(
    title = "Actitudes hacia la violencia según clase social (EGP)",
    subtitle = "Medias, desviaciones y porcentajes"
  ) %>%
  cols_align(
    align = "center",
    columns = -egp3
  )

violencia_clase_desc
```

```{r}
#| warning: false
#| message: false
#| echo: false
#| label: fig-violencia-clase
#| fig-cap: "Justificación de violencia según clase social y participación en protestas"
#| fig-height: 6
#| fig-width: 10

# Panel A: Violencia en protestas por clase
plot_clase_protesta <- elsoc_final_2 %>%
  filter(!is.na(egp3) & !is.na(protesta_dummy)) %>%
  group_by(egp3, Protesta = factor(protesta_dummy, 
                                    labels = c("No protestó", "Protestó"))) %>%
  summarise(
    Media = mean(justif_violencia_protesta, na.rm = TRUE),
    SE = sd(justif_violencia_protesta, na.rm = TRUE) / sqrt(n()),
    .groups = "drop"
  ) %>%
  ggplot(aes(x = egp3, y = Media, fill = Protesta)) +
  geom_col(position = position_dodge(width = 0.8), width = 0.7) +
  geom_errorbar(aes(ymin = Media - 1.96*SE, ymax = Media + 1.96*SE),
                position = position_dodge(width = 0.8), width = 0.3) +
  scale_fill_manual(values = c("No protestó" = "#0073C2FF", "Protestó" = "#EFC000FF")) +
  labs(
    title = "A) Justificación de Violencia en Protestas",
    x = "Clase Social (EGP)",
    y = "Justificación (escala 1-5)"
  ) +
  theme_minimal(base_size = 11) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        legend.position = "bottom")

# Panel B: Violencia estatal por clase
plot_clase_estatal <- elsoc_final_2 %>%
  filter(!is.na(egp3) & !is.na(protesta_dummy)) %>%
  group_by(egp3, Protesta = factor(protesta_dummy, 
                                    labels = c("No protestó", "Protestó"))) %>%
  summarise(
    Media = mean(justif_violencia_estatal, na.rm = TRUE),
    SE = sd(justif_violencia_estatal, na.rm = TRUE) / sqrt(n()),
    .groups = "drop"
  ) %>%
  ggplot(aes(x = egp3, y = Media, fill = Protesta)) +
  geom_col(position = position_dodge(width = 0.8), width = 0.7) +
  geom_errorbar(aes(ymin = Media - 1.96*SE, ymax = Media + 1.96*SE),
                position = position_dodge(width = 0.8), width = 0.3) +
  scale_fill_manual(values = c("No protestó" = "#0073C2FF", "Protestó" = "#EFC000FF")) +
  labs(
    title = "B) Justificación de Violencia Estatal",
    x = "Clase Social (EGP)",
    y = "Justificación (escala 1-5)"
  ) +
  theme_minimal(base_size = 11) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        legend.position = "bottom")

# Combinar
plot_clase_protesta + plot_clase_estatal +
  plot_annotation(
    title = "Actitudes hacia la violencia según clase social y experiencia de protesta",
    caption = "Fuente: ELSOC 2016-2023. Barras de error: IC 95%"
  )
```

### Modelos de regresión

```{r}
#| warning: false
#| message: false
#| echo: false

# Modelo VC1: Clase → Violencia
mod_vc1_clase_protesta <- glmmTMB(
  justif_violencia_protesta ~ egp3 + 
    edad + mujer + ideologia_std + 
    factor(year) +
    (1 | idencuesta),
  data = elsoc_final_2,
  family = gaussian())

# Modelo VC2: + Participación
mod_vc2_clase_protesta_particip <- glmmTMB(
  justif_violencia_protesta ~ egp3 + protesta_dummy +
    edad + mujer + ideologia_std + 
    factor(year) +
    (1 | idencuesta),
  data = elsoc_final_2,
  family = gaussian())

# Modelo VC3: + Interacción Clase × Protesta
mod_vc3_clase_protesta_interact <- glmmTMB(
  justif_violencia_protesta ~ egp3 * protesta_dummy +
    edad + mujer + ideologia_std + 
    factor(year) +
    (1 | idencuesta),
  data = elsoc_final_2,
  family = gaussian())

# Tabla
screenreg(list(mod_vc1_clase_protesta, mod_vc2_clase_protesta_particip, mod_vc3_clase_protesta_interact),
          custom.model.names = c("VC1: Solo Clase", "VC2: + Protesta", "VC3: Interacción"))
```

### Interpretación de resultados: Clase social y violencia

#### 1. Efectos principales de clase social (Modelo VC1)

**Hallazgo inicial**: Los efectos de clase social son **mucho más débiles** que los de educación:

- **Clase intermedia** (III+IV): -0.05* (marginalmente significativa)
- **Clase trabajadora** (V+VI+VII): +0.01 (no significativa)
- **Categoría de referencia**: Service class (I+II)

**Interpretación**: Sin controlar por participación, la clase social tiene **efectos mínimos** sobre justificación de violencia en protestas. Esto contrasta marcadamente con el análisis de educación, sugiriendo que:
- Las actitudes hacia violencia política están más vinculadas a **capital cultural** (educación) que a **posición económica/ocupacional** (clase EGP)
- O bien, los efectos de clase están **confundidos** con participación

#### 2. Efecto de participar en protestas (Modelo VC2)

Al incluir `protesta_dummy`:

- **Protesta_dummy**: +0.32*** (efecto robusto y consistente con análisis de educación)
- **Clase trabajadora**: cambia de +0.01 (n.s.) a +0.05 (n.s.)
- **Clase intermedia**: -0.03 (sigue no significativa)

**Interpretación**: El efecto de participar en protestas (+0.32***) es **similar al observado en modelos de educación** (+0.31***), confirmando que la participación es un predictor fuerte **independientemente** de si analizamos por educación o clase.

Sin embargo, incluso controlando por participación, **la clase social NO predice significativamente** las actitudes hacia violencia en protestas.

#### 3. Interacciones Clase × Protesta (Modelo VC3 - Hallazgo clave)

El modelo de interacción revela un patrón **muy diferente** al de educación:

**Efectos principales (no-participantes)**:
- Clase intermedia: -0.03 (n.s.)
- Clase trabajadora: +0.07**
- Protesta_dummy (service class): +0.36***

**Términos de interacción**:
- Clase intermedia × Protesta: +0.04 (n.s.)
- Clase trabajadora × Protesta: **-0.17** (significativa al 0.01)

#### 4. Cálculo de efectos totales por clase

**Service class (I+II - categoría de referencia)**:
- No protestó: 0.00 (referencia)
- Protestó: +0.36*** 
- → **Efecto participación**: +0.36

**Intermediate class (III+IV)**:
- No protestó: -0.03 (similar a service class)
- Protestó: -0.03 + 0.36 + 0.04 = +0.37
- → **Efecto participación**: +0.40 (el más alto)

**Working class (V+VI+VII)**:
- No protestó: +0.07** (¡justifican MÁS que service class SIN participar!)
- Protestó: +0.07 + 0.36 - 0.17 = +0.26
- → **Efecto participación**: +0.19 (el más bajo)

#### 5. Hallazgo central: Clase modera el efecto de protesta (patrón INVERSO a educación)

**Diferencia fundamental con educación**:

| Variable | Patrón de interacción |
|----------|----------------------|
| **Educación** | Más educación → MAYOR efecto de participación (interacciones positivas) |
| **Clase** | Clase trabajadora → MENOR efecto de participación (interacción negativa) |

**Interpretación teórica**:

1. **Clase trabajadora de base**: 
   - Ya justifican más violencia SIN protestar (+0.07**)
   - Participar AUMENTA menos su justificación (+0.19)
   - → Posible "efecto techo" o actitudes pre-existentes de alienación

2. **Service class**:
   - Justifican poco SIN protestar (categoría ref.)
   - Participar AUMENTA mucho su justificación (+0.36***)
   - → La participación es **más transformativa** para clases altas

3. **Clase intermedia**:
   - Patrón intermedio pero efecto total más alto (+0.40)
   - → Posible grupo más "reactivo" a experiencias de movilización

#### 6. Comparación educación vs. clase: Mecanismos diferentes

**Educación (hallazgos previos)**:
- Efecto protector entre no-participantes
- Participación **invierte** el efecto (de negativo a positivo)
- Interacciones **positivas** (más educación → mayor cambio al participar)

**Clase (hallazgos actuales)**:
- Efecto mínimo entre no-participantes (excepto working class levemente positivo)
- Participación aumenta justificación en **todas** las clases
- Interacción **negativa** para working class (menor cambio al participar)

**Síntesis teórica**:

> **La educación modula la capacidad de elaborar marcos ideológicos diferenciados según participación (efecto interactivo positivo), mientras que la clase refleja predisposiciones estructurales que amortiguan el impacto de la participación entre trabajadores (efecto interactivo negativo).**

En otras palabras:
- **Capital cultural** (educación) → Flexibilidad cognitiva que permite reconfiguración radical
- **Posición de clase** (EGP) → Predisposiciones estructurales más estables que limitan cambio

#### 7. Mejora de ajuste

- AIC mejora: 20,831 → 20,635 → 20,621
- Log Likelihood: -10,403 → -10,303 → -10,294
- Las interacciones mejoran el modelo, aunque modestamente comparado con educación

**N menor**: 9,038 obs (vs. 15,112 en modelos de educación)
- → Variable `egp3` tiene más missing data que educación

---

### Test de interacción

```{r}
#| warning: false
#| message: false
#| echo: false

# LRT: ¿Clase modera efecto de protesta?
lrt_violencia_clase <- anova(mod_vc2_clase_protesta_particip, mod_vc3_clase_protesta_interact)
print(lrt_violencia_clase)
```

**Interpretación del test de razón de verosimilitud (LRT)**:

- **χ² = 18.05, df = 2, p < 0.001*** → Las interacciones clase × protesta son **altamente significativas**
- La mejora en log-likelihood (-10,303 → -10,294) es **más sustantiva** que en el modelo de educación
- AIC mejora de 20,635 → 20,621, confirmando que las 2 interacciones (clase intermedia y working class) aportan información predictiva relevante

**Comparación con test de educación**:

| Variable | χ² | df | p-value | Interpretación |
|----------|-----|-----|---------|----------------|
| **Educación × Protesta** | 12.01 | 4 | 0.017* | Significativa |
| **Clase × Protesta** | **18.05** | 2 | **<0.001*** | **Más significativa** |

**Hallazgo importante**: Aunque la clase social tiene efectos principales más débiles que la educación, las **interacciones con participación son más fuertes y significativas**. Esto sugiere que:

1. **Educación** afecta actitudes hacia violencia **independientemente** de participación (efectos principales fuertes)
2. **Clase** afecta principalmente **cómo la participación transforma** actitudes (efectos de interacción más fuertes)

**Implicación teórica**:

> **La clase social importa menos para determinar actitudes "de línea base" hacia violencia, pero es crucial para entender cómo la experiencia de movilización diferencia trayectorias de cambio actitudinal.**

Específicamente:
- **Service class**: Participación los transforma radicalmente (efecto máximo)
- **Working class**: Participación tiene efecto moderado (ya parten de mayor tolerancia)
- **Intermediate class**: Patrón intermedio

Este hallazgo refuerza la interpretación de que clase opera principalmente como **moderador estructural** del impacto de experiencias de movilización, mientras que educación opera como predictor directo de actitudes.

---

### Visualización de efectos marginales

```{r}
#| warning: false
#| message: false
#| echo: false
#| label: fig-efectos-marginales-clase
#| fig-cap: "Efectos marginales de protesta sobre justificación de violencia según clase social"

library(ggeffects)

# Predicciones del modelo de interacción
pred_clase_violencia <- ggpredict(mod_vc3_clase_protesta_interact, 
                                   terms = c("protesta_dummy", "egp3"))

plot(pred_clase_violencia) +
  labs(
    title = "Efecto de participar en protestas sobre justificación de violencia",
    subtitle = "Según clase social (EGP)",
    x = "Participación en Protestas",
    y = "Justificación de violencia en protestas (predicha)",
    color = "Clase Social"
  ) +
  theme_minimal(base_size = 12) +
  theme(legend.position = "bottom")
```

### Interpretación del gráfico de efectos marginales

Este gráfico visualiza las interacciones clase × protesta analizadas en el Modelo VC3, mostrando hallazgos teóricamente importantes:

#### 1. Pendientes diferenciadas: La clave de la interacción

**Service class (I+II - línea roja/superior)**: 
- Pendiente **más pronunciada** (~0.45 de diferencia entre no participar y participar)
- Parten de justificación más baja (~1.75 sin participar)
- Alcanzan el nivel **MÁS ALTO** al participar (~2.19)
- → **Efecto máximo de la participación** (+0.36***)

**Intermediate class (III+IV - línea naranja/media)**:
- Pendiente también pronunciada (similar o levemente mayor que service class)
- Parten de nivel intermedio (~1.72 sin participar)
- Alcanzan nivel alto al participar (~2.09-2.12)
- → Efecto fuerte de participación (~+0.37-0.40)

**Working class (V+VI+VII - línea verde/inferior)**:
- Pendiente **menos pronunciada** (la más plana de las tres)
- Parten de nivel **MÁS ALTO** sin participar (~1.82-1.85)
- Aumentan menos al participar (~2.03-2.08)
- → **Efecto reducido de participación** (+0.19-0.26, debido a interacción negativa -0.17**)

#### 2. Convergencia al participar: Homogeneización de actitudes

**Hallazgo visual crucial**: Las tres líneas **convergen** hacia la derecha del gráfico (participación = 1):

- **Sin participar** (izquierda): Clases **diferenciadas** (rango ~0.10-0.13 puntos entre extremos)
- **Con participación** (derecha): Clases **más homogéneas** (rango ~0.08-0.11 puntos)

**Interpretación**: La participación en protestas actúa como **nivelador de actitudes** entre clases sociales. Aunque persisten diferencias, la experiencia de movilización reduce la brecha entre service class y working class en términos de justificación de violencia.

#### 3. Bandas de confianza (IC 95%): Significancia de diferencias

Las **bandas sombreadas** (intervalos de confianza) muestran:

- **Service class**: Banda más estrecha (mayor precisión debido a tamaño muestral o menor varianza)
- **Working class**: Banda más ancha, especialmente en extremo derecho (participantes)
- **Solapamiento parcial**: Las bandas se solapan entre clases, sugiriendo que las diferencias absolutas no son enormes en magnitud (aunque las interacciones son estadísticamente significativas)

#### 4. Contraste con efectos de educación (hallazgos previos)

| Característica | Educación × Protesta | Clase × Protesta |
|----------------|---------------------|------------------|
| **Dirección pendientes** | Más educación → pendiente MÁS pronunciada | Working class → pendiente MENOS pronunciada |
| **Punto de partida** | Universitarios parten MÁS bajo | Working class parte MÁS alto |
| **Convergencia** | **Divergen** al participar | **Convergen** al participar |
| **Mecanismo** | Amplificación cognitiva | Efecto techo estructural |

**Diferencia fundamental**:
- **Educación**: Genera **divergencia** (participación amplifica diferencias educativas)
- **Clase**: Genera **convergencia** (participación reduce diferencias de clase)

#### 5. Implicaciones sociológicas del patrón visual

**¿Por qué service class cambia más?**

Posibles mecanismos teóricos:
1. **Distancia de clase desde el conflicto**: Service class está más alejada de experiencias cotidianas de violencia/represión; participar es más "disruptivo" cognitivamente
2. **Marcos ideológicos pre-movilización**: Parten de socialización pro-orden; participar requiere reelaboración radical de marcos morales
3. **Recursos cognitivos**: Mayor educación (correlación clase-educación) facilita elaboración de justificaciones ideológicas complejas post-participación

**¿Por qué working class cambia menos?**

Posibles mecanismos:
1. **Efecto techo**: Ya parten de mayor justificación (+0.07**); menos espacio para aumentar
2. **Experiencias estructurales previas**: Mayor exposición a violencia cotidiana (policial, criminalidad) reduce novedad de violencia en protestas
3. **Alienación pre-existente**: Predisposiciones estructurales hacia formas de resistencia ya incorporadas antes de participar

#### 6. Validación estadística visual

El gráfico **confirma visualmente** el test LRT (χ² = 18.05, p < 0.001***):
- Las pendientes son **claramente diferentes** (especialmente service class vs working class)
- La diferencia en pendientes es el **efecto de interacción**
- Working class tiene pendiente significativamente más plana (interacción -0.17**)

#### 7. Lectura política del gráfico

Este patrón tiene implicaciones para entender **quién se radicaliza más** en contextos de movilización masiva:

**Contraintuitivo**: No son las clases trabajadoras (tradicionalmente vistas como "radicales"), sino las **clases medias-altas (service class)** las que experimentan mayor transformación de actitudes hacia violencia al participar.

Esto sugiere que movimientos como el estallido chileno de 2019 pueden haber sido particularmente **transformativos para sectores profesionales/gerenciales** que participaron, generando reconfiguración de marcos morales entre grupos normalmente orientados hacia estabilidad/orden.

---

## Síntesis: Violencia, Educación y Clase

### Hallazgos principales

**1. Educación y violencia**:
- [Resumir hallazgos clave]
- [Interpretar interacciones]

**2. Clase y violencia**:
- [Resumir hallazgos clave]
- [Interpretar interacciones]

**3. Comparación violencia en protestas vs. violencia estatal**:
- [Analizar diferencias en patrones]

### Tabla comparativa integrada

```{r}
#| warning: false
#| message: false
#| echo: false
#| label: tbl-violencia-comparativa
#| tbl-cap: "Comparación de modelos: Educación vs Clase predicting violencia"

screenreg(list(mod_v3_educ_protesta_interact, mod_vc3_clase_protesta_interact,
               mod_ve_educ_estatal, mod_vc3_clase_protesta_interact),
          custom.model.names = c("Educ → Viol. Protesta", "Clase → Viol. Protesta",
                                  "Educ → Viol. Estatal", "Clase → Viol. Estatal (Protesta)"),
          custom.note = "Fuente: ELSOC 2016-2023. Modelos multinivel con efectos aleatorios individuales.")
```

### Lectura integrada de la tabla comparativa

Esta tabla consolida los hallazgos centrales del análisis exploratorio, revelando **cuatro patrones diferenciados** según:
1. Tipo de estratificación (educación vs. clase)
2. Tipo de violencia (en protestas vs. estatal)

#### **Hallazgo 1: Educación vs Clase - Mecanismos diferenciados**

**EDUCACIÓN** (columnas 1 y 3):
- **Efectos principales fuertes** sobre violencia en protestas (-0.11*** a -0.13**)
- **Interacciones positivas** con participación (+0.13** universitaria completa)
- Casi **nulos sobre violencia estatal** (+0.03 a +0.10, todos n.s.)
- → Educación como **capital cultural** que moldea actitudes base

**CLASE SOCIAL** (columnas 2 y 4):
- **Efectos principales débiles** sobre violencia en protestas (+0.07** working class únicamente)
- **Interacciones negativas** con participación (-0.17** working class)
- Mismos coeficientes para ambos tipos de violencia (modelo 4 repite modelo 2)
- → Clase como **moderador estructural** de efectos de participación

#### **Hallazgo 2: Violencia en protestas vs Estatal - Efectos invertidos**

**Educación × Protesta sobre VIOLENCIA EN PROTESTAS** (columna 1):
- Universitaria completa × Protesta: **+0.13**
- → Participar aumenta justificación entre universitarios

**Educación × Protesta sobre VIOLENCIA ESTATAL** (columna 3):
- Universitaria incompleta × Protesta: **-0.16**
- Universitaria completa × Protesta: **-0.18***
- → Participar REDUCE justificación de violencia policial entre universitarios

**Patrón bidireccional coherente**: Universitarios participantes desarrollan marcos morales que **legitiman violencia táctica** en manifestaciones mientras **deslegitiman violencia institucional** del Estado.

#### **Hallazgo 3: Participación en protestas - Efecto robusto y consistente**

**Efecto principal de `protesta_dummy`** (para categorías de referencia):

| Modelo | Coeficiente | Interpretación |
|--------|-------------|----------------|
| Educ → Viol. Protesta | +0.23*** | Fuerte |
| Clase → Viol. Protesta | +0.36*** | **Muy fuerte** |
| Educ → Viol. Estatal | -0.04 (n.s.) | Nulo |
| Clase → Viol. Estatal | +0.36*** | Idéntico a modelo 2 |

**Nota**: El modelo 4 parece ser idéntico al modelo 2 (¿error en especificación de columna?). Los coeficientes de clase son exactamente iguales en columnas 2 y 4.

#### **Hallazgo 4: Variables de control - Patrones consistentes**

**Ideología** (eje izquierda-derecha):
- Violencia en protestas: **-0.02 a -0.03*** (derecha justifica MENOS)
- Violencia estatal: **+0.05*** (derecha justifica MÁS)
- → Coherencia ideológica clara: derecha critica violencia disruptiva, legitima violencia institucional

**Género**:
- Violencia en protestas: -0.02 a -0.03 (n.s.)
- Violencia estatal: **-0.13*** (mujeres critican MÁS violencia policial)
- → Hallazgo importante: mujeres especialmente críticas de violencia institucional

**Edad**:
- Violencia en protestas: **-0.01*** (mayores justifican menos)
- Violencia estatal: **+0.00*** (efecto prácticamente nulo)
- → Edad asociada con conservadurismo solo respecto a violencia disruptiva

**Año 2019** (estallido social):
- Violencia en protestas: **-0.33*** a -0.34***
- Violencia estatal: **-0.40***
- → Paradoja: Durante mayor conflicto, MENOR justificación de ambos tipos de violencia (posible saturación mediática o "fatiga de violencia")

#### **Hallazgo 5: Heterogeneidad individual (efectos aleatorios)**

**Varianza del intercepto individual**:

| Modelo | Var(Intercepto) | Interpretación |
|--------|-----------------|----------------|
| Educ → Viol. Protesta | 0.12 | Moderada |
| Clase → Viol. Protesta | 0.11 | Moderada (levemente menor) |
| Educ → Viol. Estatal | **0.20** | **Alta** |
| Clase → Viol. Estatal | 0.11 | Moderada |

**Interpretación crítica**: Las actitudes hacia **violencia estatal** muestran **mucha mayor heterogeneidad individual** (0.20) que violencia en protestas (0.11-0.12). Esto sugiere que experiencias personales diferenciadas con Carabineros (represión directa, discriminación, etc.) generan mayor variabilidad en actitudes que la que generan experiencias/posiciones sociales respecto a violencia en manifestaciones.

#### **Hallazgo 6: Diferencias en N - Implicaciones metodológicas**

- **Modelos de educación**: N = 15,112 (violencia protesta), 15,103 (violencia estatal)
- **Modelos de clase**: N = 9,038 (ambos tipos de violencia)
- → Variable EGP tiene **~40% más missing data** que educación
- → Resultados de clase menos generalizables (pérdida de casos)

#### **Síntesis teórica integrada: Tres dimensiones de estratificación**

La tabla revela que las actitudes hacia violencia política están estratificadas por **tres dimensiones independientes**:

**1. Capital cultural (Educación)**:
- Determina actitudes "de línea base" (efectos principales)
- Modera capacidad de reconfiguración ideológica al participar (interacciones positivas)
- Efecto diferenciado según tipo de violencia (críticos de protestas, tolerantes de Estado)

**2. Posición estructural (Clase)**:
- Efectos principales mínimos (excepto working class con predisposición)
- Modera INTENSIDAD del cambio al participar (interacciones negativas)
- Efecto techo entre trabajadores limita impacto de participación

**3. Experiencia vivida (Participación)**:
- Efecto sustantivo robusto (+0.23 a +0.36***)
- Interactúa con educación (amplifica) y clase (amortigua)
- Genera reconfiguración bidireccional (legitima violencia táctica, deslegitima violencia estatal)

**Modelo conceptual resultante**:

$$
\text{Actitud hacia violencia} = f(\underbrace{\text{Capital cultural}}_{\text{Línea base}} + \underbrace{\text{Posición estructural}}_{\text{Predisposición}} + \underbrace{\text{Experiencia}}_{\text{Transformación}} + \underbrace{\text{Interacciones}}_{\text{Heterogeneidad de efectos}})
$$

**Implicación para teoría de movimientos sociales**: La participación en protestas no tiene efectos uniformes, sino que **amplifica desigualdades educativas** (más educados cambian más radicalmente) mientras **reduce desigualdades de clase** (efecto nivelador entre working y service class).